!function(t){function n(e){this.target=e}var e=t.beacon,r=function(e){return this!==t&&r.blend(this,r),new n(e)};r.toString=function(){return"baishuiz@gmail.com"};var o={base:a,avatarCore:n.prototype,self:a,init:function(){var e=Object.freeze;t.beacon=r,o.merge(r,a),delete t.beacon.base,e&&e(r)},login:function(){t.beacon=r},logoff:function(){t.beacon=e}},a={base:o};t.beacon=a}(this),function(e){var t=beacon.base||{},p={merge:function(e){for(var t=arguments.length,n=1;n<t;n++){var r=arguments[n];for(var o in r)e[o]!==r[o]&&(e[o]=r[o])}return e},blend:function(e,t,n){var r={cover:!0,mergePrototype:!1,reset:!1};if(n=n?p.merge(r,n):r,t=[].concat(t),n.reset)for(var o in e)t[0][o]||(t[0][o]=void 0);for(var a=t.length,i=0;i<a;i++){var c=t[i];for(var u in c){var s=n.mergePrototype||c.hasOwnProperty(u),l=n.cover||!e[u];s&&l&&(e[u]=c[u])}}return e},isType:function(e,t){return"Null"===t&&null===e||"Undefined"===t&&void 0===e||"Number"===t&&isFinite(e)||Object.prototype.toString.call(e).slice(8,-1)===t},arrayIndexOf:function(e,t){return p.arrayIndexOf=Array.prototype.indexOf?function(e,t){return(e=[].slice.call(e,0)).indexOf(t)}:function(e,t){for(var n=(e=[].slice.call(e,0)).length;0<=n;n--)if(e[n]===t)return n;return n},p.arrayIndexOf(e,t)},each:function(e,t){if(e){e=[].concat(e);for(var n=0;n<e.length;n++)t.call(e[n],n,e[n])}}};p.blend(t,p)}(),function(e){var t=beacon.base;t.EventStructure=function(e){function i(e){var t=o(c,e);t<0&&(t=c.push(e)-1);var n="event_"+t;return e.toString()===e?e:n}var o=t.arrayIndexOf,c=[];return{dom:e,target:e,attachEvent:function(e,t){var n=i(e);c[n]=c[n]||[],c[n].push(t)},removeEvent:function(e,t){var n,r=e&&i(e),o=r&&c[r];if(e&&t)for(var a=o.length-1;0<=a;a--)o[a]===t&&(n=c[r].splice(a,1));else e&&!t?(n=c[r],c[r]=[]):e||t||(n=c,c=[]);return n},getEventList:function(e){var t;if(!e)return c.slice(0);var n,r=o(c,n=e)<0?null:i(n);return r&&(t=e?c[r]:c.slice(0)),t}}}}(),function(e){function a(e,t,n){var r;(c(e)||(r=new o(e),u.push(r),r)).attachEvent(t,n)}function i(e,n,r){var o=u.slice(0),t=e?c(e)||[]:u.slice(0);s.each(t,function(e,t){if(t.removeEvent(n,r),!n&&!r||0==t.getEventList().length){e=s.arrayIndexOf(u,t);o.splice(e,1)}}),u=o}function c(e){if(!e)return u.slice(0);for(var t=0;t<u.length;t++){var n=u[t];if(n.target===e)return n}}var u=[],s=e.base,o=s.EventStructure,t={registEvent:a,registCombinationEvent:function(t,e,n){var r=e.registEvent(n),o=e.getEventList();s.each(o,function(e){a(t,o[e],r)})},removeEvent:i,removeCombinationEvent:function(r,o,e){var a=o.removeEvent(e);s.each(a,function(e){var n=a[e],t=o.getEventList();s.each(t,function(e,t){i(r,t,n)})})},getEventList:c};s.eventStore=t}(beacon),function(e){var l=beacon.base;l.combinationalEvent=function e(){if(this instanceof e)return this;var c=[],u=[],s=[].slice.call(arguments,0),t=(s.slice(0),function(){function i(){return s.slice(0)}this.resetEventList=i,this.getEventList=function(){return s.slice(0)},this.registEvent=function(r){var e,t,o=l.arrayIndexOf,a=s.slice(0),n=function(e,t){var n=o(a,e.eventType);0<=n&&a.splice(n,1),0===a.length&&(r.call(this,t),a=i())};return e=r,t=n,l.arrayIndexOf(c,e)<0&&(c.push(e),u.push(t)),n},this.removeEvent=function(e){var t,n,r;return[].concat((t=e,n=l.arrayIndexOf(c,t),r=u[n],t?r:u.slice(0)))}});return t.prototype=new e,new t}}(),function(e){var t,i=beacon.base,n=i.eventStore,r=n.registCombinationEvent,o=n.registEvent,a=n.removeCombinationEvent,c=n.removeEvent,u=n.getEventList,s={hostProxy:{},attachActionEvent:function(n,e,t){var r=n.desc,o=i.isType(n.desc,"Function");o&&r(e,t);i.each(["touchmove","mousemove"],function(e,t){o&&window.beacon(document).on(t,function(e){s.publicDispatchEvent(n,e)})})},attachEvent:function(e,t){var n=e instanceof i.combinationalEvent?r:o;s.attachActionEvent(e,this,t),n(this,e,t)},fireEvent:function(r,o){var a=this,e=u(a);if(e){var t=e.getEventList(r),n=i.isType(r.desc,"Function");!!(n&&r.desc(o))==!!n&&i.each(t,function(e,t){var n={eventType:r};t.call(a,n,o)})}},publicDispatchEvent:function(n,r){var o=u();i.isType(n.desc,"Function")&&n.desc(r),i.each(o,function(e){var t=o[e].dom;s.fireEvent.call(t,n,r)})},removeEvent:function(e,t){(e instanceof i.combinationalEvent?a:c)(this,e,t)}},l=((t=function(){}).prototype=s,i.blend(t,s),t);i.Event=l}(),function(e){var c=beacon.base,i=function(){return this}(),o=c.EventStructure,a={structures:[],getStructure:function(t){for(var n,r,e=0;e<a.structures.length;e++){n=a.structures[e];try{r=n.dom===t}catch(e){n.dom=window.document,r=n.dom===t}if(r)return n}},add:function(e,t,n){var r=a.getStructure(e);r||(r=new o(e),a.structures.push(r)),r.attachEvent(t,n)},remove:function(e,t,n){var r=a.getStructure(e);return r&&r.removeEvent(t,n)}},u={attachEvent:function(e,t){var n,r=function(e,t){this.addEventListener(e,t,!1)},o=function(e,t){this.attachEvent("on"+e,t)},a=function(e,t){var n=this,r=n["on"+e];n["on"+e]=function(){r.call(n),t.call(n)}};return i.addEventListener?(r.call(this,e,t),n=r):i.attachEvent?(o.call(this,e,t),n=o):(a.call(this,e,t),n=a),u.attachEvent=n},fireEvent:function(e,t){var n,r=function(e,t){(t=t||{bubbles:!0,cancelable:!0}).ieHack=this.all&&this.all.toString(),t.ieHack=this.style;var n=document.createEvent("Event");n.initEvent(e,t.bubbles,t.cancelable),t.state&&(n.state=t.state),this.dispatchEvent(n)},o=function(e,t){(t=t||{bubbles:!0,cancelable:!0}).ieHack=this.all&&this.all.toString(),t.ieHack=this.style,e="on"+e;var n=document.createEventObject();n.cancelBubble=t.cancelable,this.fireEvent(e,n)};return document.createEvent&&this.dispatchEvent?(r.call(this,e,t),n=r):document.createEventObject&&this.fireEvent&&(o.call(this,e,t),n=o),n},removeEvent:function(e,t){var n,r=function(e,t){this.removeEventListener(e,t,!1)},o=function(e,t){this.detachEvent("on"+e,t)};return this.removeEventListener?(r.call(this,e,t),n=r):this.detachEvent&&(o.call(this,e,t),n=o),u.removeEvent=n}},s={attachEvent:function(e,t){a.add(this,e,t),u.attachEvent.call(this,e,t)},fireEvent:function(e,t){s.fireEVent=u.fireEvent.call(this,e,t)},removeEvent:function(e,t){var n=this;if(e&&t)u.removeEvent.call(n,e,t);else if(e&&!t){var r=a.remove(n,e);r&&c.each(r,function(){s.removeEvent.call(n,e,this)})}else if(!e&&!t){var o=a.remove(n);o&&c.each(o,function(){var e=this;e&&c.each(o[e],function(){s.removeEvent.call(n,e,this)})})}},isHTMLElement:function(e){var t;return e==document||e==window||(t=e)&&t.nodeName&&t.nodeType},isEventSupported:function(e,t){if(!s.isHTMLElement(e)||!c.isType(t,"String"))return!1;var n=!1;if(e===window||e===document){n="on"+t in e;var r=!!window.ActiveXObject&&!!document.documentMode;if(!n&&r)return!1;if(n)return!0;var o=document.createElement("iframe");o.style.display="none",document.body.appendChild(o);var a=e===window?o.contentWindow:o.contentDocument;s.attachEvent.call(a,t,function(){n=!0}),s.fireEvent.call(a,t),o.parentNode.removeChild(o)}else{var i=e.tagName;t="on"+t;e=document.createElement(i),(n=t in e)||(e.setAttribute(t,"return;"),n="function"==typeof e[t]),e=null}return n}};c.DOMEvent=s}(),function(s){var t,n,e,r,o,a,i,c=s.base,u={on:(e=s.base,r=e.isType,o=e.Event.hostProxy,a=e.Event.publicDispatchEvent,i=e.Event.attachEvent,function(e,t){var n=[].slice.call(arguments,0);t&&r(t,"Function")?i.apply(o,n):a.apply(o,n)}),once:function(n,r){var o=function(e,t){u.off(n,o),r.call({},e,t)};u.on(n,o)},off:(t=s.base,n=t.Event.hostProxy,function(){var e=[].slice.call(arguments,0);t.Event.removeEvent.apply(n,e)}),blend:c.blend,NS:c.NS,arrayIndexOf:c.ArrayIndexOf,isType:c.isType,Enum:c.Enum,loginGlobal:c.login,logoffGlobal:c.logoff,utility:c,createEvent:function(){var e=[].slice.call(arguments,0);return 1<arguments.length?c.combinationalEvent.apply(this,e):{desc:e[0]}}},l={on:function(e,t){var n=[].slice.call(arguments,0),r=this.target,o=s.base,a=o.DOMEvent.isHTMLElement(r),i=o.DOMEvent.isEventSupported(r,e),c=a&&i?o.DOMEvent.fireEvent:o.Event.fireEvent,u=a&&i?o.DOMEvent.attachEvent:o.Event.attachEvent;t&&o.isType(t,"Function")?o.each(r,function(e,t){u.apply(t,n)}):o.each(r,function(e,t){c.apply(t,n)})},once:function(n,r){var o=this,a=function(e,t){l.off.call(o,n,a),r.call(o,e,t)};l.on.call(o,n,a)},off:function(r,o,a){var e=this.target,i=c.DOMEvent.isHTMLElement(e),t=r&&c.DOMEvent.isEventSupported(e,r);i&&t?c.DOMEvent.removeEvent:c.Event.removeEvent,c.each(e,function(e,t){var n=r&&c.DOMEvent.isEventSupported(t,r);i&&c.DOMEvent.removeEvent.call(t,r,o,a),n||c.Event.removeEvent.call(t,r,o,a)})}};c.blend(c.avatarCore,l),c.blend(s,u),c.init()}(beacon),function(t){function n(e){this.target=e}var r=function(e){return new n(e)};r.toString=function(){return"baishuiz@gmail.com"};var e=document.getElementsByTagName("script"),o=e[e.length-1],a={avatarCore:n.prototype,plugins:{},attach:function(e,t){a.plugins[e]=t},baseURL:o.src.replace(/\/[^\/]+$/,"/"),URLMap:{},CDNTimestamp:o.getAttribute("data-CDNTimestamp")||"",isDebug:!1,init:function(e){t.Air=a.plugins.merge(r,e)}},i={base:a};t.Air=i}(this),function(t){var e={NS:function(e,t){for(var n=e.split("."),r=t||window||{},o=(t=r,0),a=n.length;o<a;o++)r[n[o]]=void 0===r[n[o]]?{}:r[n[o]],r=r[n[o]];return r},beacon:beacon,merge:beacon.utility.merge,setBaseURL:function(e){return beacon.isType(e,"Object")?(t.base.URLMap=e,t.base.baseURL=e.base||t.base.baseURL):t.base.baseURL=e||t.base.baseURL}};e.merge(t.base.plugins,e)}(Air),function(e){var t=!1,n=[],r=e.base.plugins.beacon,o=(e.base.plugins,function(){r(document).off("readystatechange",a),r(document).off("DOMContentLoaded",o),r(window).off("load",o);for(var e;e=n.shift();)t||e();t=!0}),a=function(){(/loaded|complete/.test(document.readyState)||1==t)&&o()};r(document).on("readystatechange",a),r(document).on("DOMContentLoaded",o),r(window).on("load",o),document.documentElement.doScroll&&function t(){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(t,1)}o()}(),e.base.attach("DOMReady",function(e){return 1==t?void e():void n.push(e)})}(Air),function(e,p){function o(t,n){var r=1;this.loadJS=function(){if(/\bArray\b/.test(Object.prototype.toString.call(t)))for(var e=(r=t.length)-1;0<=e;e--)a(t[e],function(){--r||n()});else a(t,n)}}function r(){function n(){r.currentJs||(r.currentJs=r.shift(),r.currentJs&&r.currentJs.loadJS())}var r=[];r.currentJs=null,this.loadJS=function(e,t){return r.push(new o(e,function(){r.currentJs=null,t&&t(),n()})),n(),this}}function a(e,t){var n,r=document.getElementsByTagName("head")[0],o=document.createElement("script"),a=!1,i=p.base.plugins.beacon,c=function(){a=!0,i(o).off("load"),i(o).off("readystatechange"),c=function(){},t&&t()};o.async=!0,o.setAttribute("type","text/javascript"),o.src=e,i(o).on("load",c),i(o).on("readystatechange",function(){/loaded|complete/.test(o.readyState)&&0==a&&c()}),i(o).on("error",c);for(var u=document.getElementsByTagName("script"),s=0,l=u.length;!n&&s<l;s++)n=e==u[s].getAttribute("src");n||r.appendChild(o)}p.base.attach("loadJS",function(e,t){var n=new r;return n.loadJS(e,t),n})}(0,Air),function(v){var d={};v.base.Module=function(c,u){"use strict";function r(){var e=l.toLowerCase(),t=s.toLowerCase(),n=v.base,r=n.plugins.beacon,o=n.plugins.NS,a=n.plugins.NS(s.toLowerCase(),n)[e],i=u(n.Require,n.run);a?"function"==typeof i?o(t,n)[e]=n.plugins.merge(i,a):n.plugins.merge(a,i):o(t,n)[e]=i,d[c.toLowerCase()]=!0,r.on(v.base.Require.Event.LOADED,{moduleName:c})}v.base.plugins.beacon.on(v.base.Require.Event.REQUIREING,{moduleName:c});var e=c.match(/(^.*)\.(\w*)$/),s=e[1],l=e[2],t=u.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,""),n=(t=t.replace(/(['"\/])[\w\W]*?\1|((['"\/])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(e,t){return t?e:""})).replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(e,t){return t}).replace(t,""),o=n&&new RegExp("\\b"+n+"\\s*\\(([^\\)]+)\\)","gm"),p=[];o&&t.replace(o,function(e,t){var n,r,o=/['" ]/g,a=t.split(",");1<a.length?(n=a[0].replace(o,""),r=a[1].replace(o,"")):n=t.replace(o,"");var i=n.toLowerCase();d[i]||(p[i]=p.push(i)-1),v.base.Require(n,r)});var a=new String(c);p.length&&beacon(a).on(v.base.Require.Event.LOADED,function(e,t){var n=t.moduleName.toLowerCase();p.hasOwnProperty(n)&&(delete p[n],p.splice(p[n],1)),p.length<=0&&(beacon(a).off(v.base.Require.Event.LOADED),r())}),p.length||r()}}(Air),function(s){function l(e){if(e)return v.moduleLoaded[e];for(var t=0,n=v.requireQueue.length;t<n;t++){var r=v.requireQueue[t];if(!v.moduleLoaded[r])return!1}return!0}function p(){e.on(n.COMPLETE),e(document).on("readystatechange"),p=function(){e.on(n.COMPLETE)}}var e=s.base.plugins.beacon,t=e.createEvent,n={COMPLETE:t("require_complete"),LOADED:t("require_loaded"),REQUIREING:t("require_requireing")},v={requiring:{},required:{},moduleLoaded:{},requireQueue:[]};e(v).on(n.REQUIREING,function(e,t){var n=t.moduleName.toLowerCase();v.requireQueue[n]||v.requireQueue.push(n),v.required[n]=!0});var r=function(e,t){var n,r,o,a,i,c=e;if(e=e.toLowerCase(),v.required[e]||v.requiring[e]||v.moduleLoaded[e])return s.base.plugins.NS(e,s.base);if(t){var u=s.base.URLMap||{};t=t.replace(/{{(.+)}}/g,function(e,t){return u[t]||s.base.baseURL})}return t=t||((a=(o=c).match(/(^.*)(\.\w*)$/))[1],a[2],i=(i=s.base.CDNTimestamp||"")&&"?"+i,s.base.baseURL+o.replace(/\./gi,"/")+".js"+i),e=e.toLowerCase(),v.requireQueue[e]=!0,v.requireQueue.push(e),r=n=e,v.required[r]||v.requiring[r]||v.moduleLoaded[r]||(v.requiring[n]=!0,s.base.plugins.loadJS(t,function(){if(!v.required[n])throw new Error("module ["+n+"] is undefined! @"+t);l()&&p()})),s.base.plugins.NS(e,s.base)};e.on(n.LOADED,function(e,t){var n=t.moduleName.toLowerCase();v.required[n]=!0,v.moduleLoaded[n]=!0,l()&&p()}),r.Event=n,r.isRequireComplete=l,s.base.Require=r}(Air),function(c){function u(){for(;e=void 0,(e=s.shift())&&e(),s.length;);var e}var s=[],l=c.base.plugins.beacon,p=c.base.Require.Event;l.on(p.COMPLETE,u);var v=function(t,e){"use strict";if(!(this instanceof v))return new v(t,e,arguments);var n=[].slice.call(arguments[2]).slice(2),i=this;i.runNow=e,function(){function r(){for(var e=0;e<a.length;e++){var t=a[e];if(!a[t]&&!c.base.Require.isRequireComplete(t))return!1}return!0}var o,a=[];this.runNow&&l.on(p.LOADED,function(e,t){var n=t.moduleName.toLowerCase();a[n]=!0,0<=beacon.utility.arrayIndexOf(a,n)&&r()&&o&&o()}),this.run=function(e){o=e,this.runNow?r()&&e():(s.push(e),c.base.Require.isRequireComplete()&&u())},this.require=function(e,t){if(c.base.Require(e,t),e=e.toLowerCase(),a.push(e),!t){var n=e.match(/(^.*)\.(\w*)$/),r=n[1],o=n[2];c.base.plugins.NS(r,c.base)[o]}return c.base.plugins.NS(e,c.base)}}.call(i);var r=t.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,""),o=(r=r.replace(/(['"\/])[\w\W]*?\1|((['"\/])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(e,t){return t?e:""})).replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(e,t){return t}).replace(r,""),a=o&&new RegExp("\\b"+o+"\\s*\\(([^\\)]+)\\)","gm");a&&r.replace(a,function(e,t){var n,r,o=/['" ]/g,a=t.split(",");1<a.length?(n=a[0].replace(o,""),r=a[1].replace(o,"")):n=t.replace(o,""),i.require(n,r)}),i.run(function(){var e=[i.require].concat(n);t.apply(this,e)})};c.base.attach("run",v)}(Air),function(e){var t=e.base.plugins,n={run:t.run,iRun:function(e){t.run(e,!0)},loadJS:t.loadJS,Module:e.base.Module,merge:e.base.merge,NS:t.NS,Enum:e.base.Enum,domReady:t.DOMReady,moduleURL:t.setBaseURL,setCDNTimestamp:e.base.setCDNTimestamp};e.base.init(n)}(Air),Air.Module("B.util.middleware",function(){var c={};return{add:function(e,t){e&&t&&(c[e]=c[e]||[],c[e].push(t))},run:function(e,t,n){var r=c[e],o=r&&r.length;if(n=n||function(){},o){var a=0,i=function(){var e=r[a];a<o&&e?e(t,function(){a++,i.apply(i,arguments)}):n.apply(n,arguments)};i()}else n()},remove:function(e,t){if(e&&t){var n=c[e]||[],r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}}),Air.Module("B.util.node",function(){var e=function(t){return{hasAttribute:function(e){return t.attributes.getNamedItem(e)}}};return e.type={TEXT:3,HTML:1,ATTR:2},e}),Air.Module("B.util.util",function(require){var t=require("B.util.node");return function(){function c(){}return c.isEmpty=function(e){if(null==e)return!0;var t=beacon.utility.isType(e,"Object"),n=beacon.utility.isType(e,"Array");if(!t&&!n)return!1;for(var r in e)if(e.hasOwnProperty(r))return!1;return!0},c.enums=function(e){for(var t={},n=e.length-1;0<=n;n--)t[e[n]]=e[n];return t},c.getData=function(e,t){for(var n=t.parent,r=e.split("."),o=t||window||{},a=(t=o,0),i=r.length;a<i;a++){if(!o||void 0===o[r[a]])return n&&c.getData(e,n);o=o[r[a]]}return o},c.trim=function(e){return(e=e||"").trim?e.trim():e.replace(/^\s+|\s+^/,"")},c.isHTML=function(e){return!!e&&e.nodeType===t.type.HTML},c}()}),Air.Module("B.data.memCache",function(){var o={},a={};return{get:function(e){if(e){var t=o[e],n=a[e];return n&&(new Date).getTime()>n.getTime()?(delete o[e],void delete a[e]):t}},set:function(e,t,n){if(e&&(o[e]=t,n&&"number"==typeof n.expiredSecond)){var r=new Date;r.setSeconds(r.getSeconds()+n.expiredSecond),a[e]=r}}}}),Air.Module("B.data.storage",function(require){var r=require("B.data.memCache");return{get:function(e,t){var n=r.get(e);return t&&t(n),n},set:r.set}}),Air.Module("B.event.events",function(){return{DATA_CHANGE:beacon.createEvent("data change"),RUN_COMPLETE:beacon.createEvent("run complete"),URL_CHANGE:beacon.createEvent("url change"),USER_ACTION:beacon.createEvent("user action"),PAGE_SHOW:beacon.createEvent("page show"),PAGE_HIDE:beacon.createEvent("page hide"),PAGE404:beacon.createEvent("")}}),Air.Module("B.directive.event",function(require){var node=require("B.util.node"),EVENTS=require("B.event.events"),attribute="b-event",reg=/\((.*)\)/,api=function(target,$scope){if(node(target).hasAttribute(attribute))for(var cmd=target.getAttribute(attribute),cmdList=cmd.split(";"),i=0;i<cmdList.length;i++)bind(cmdList[i],i);function getParentScope(e){return e}function bind(cmd,eventIndex){var eventName=cmd.match(/^\s*(\w+)\s+/)[1];beacon(target).on(eventName,function(e){var cmd=target.getAttribute(attribute),cmdList=cmd.split(";"),handleStr=cmdList[eventIndex].replace(eventName,""),eventHandleName=handleStr.replace(reg,"").replace(/\s/g,""),eventParam=handleStr.match(reg)[1],params=eval("["+eventParam+"]");params.unshift(e),this.$index=$scope.$index;var scope=getParentScope($scope),eventHandle=$scope.$event&&$scope.$event[eventHandleName]||scope.$event&&scope.$event[eventHandleName];eventHandle&&eventHandle.apply(this,params),beacon(scope).on(EVENTS.DATA_CHANGE,scope)})}};return api}),Air.Module("B.directive.show",function(require){var r=require("B.util.node"),a=(require("B.event.events"),require("B.util.util"),"b-show"),e=function(e,t,n){r(e).hasAttribute(a)&&function(t,e,n){e.scope;var r=e.name,o=t.getAttributeNode(a);o.nodeValue="{{("+o.nodeValue+")}}";n(o.nodeValue,o,r,function(e){e?i(t,!0):i(t)},!0)}(e,t,n)};function u(e,t,n){return e.bData=e.bData||{},e.bData[t]=n}e.key=a;var s={};function l(e){var t,n,r,o=document.body.appendChild(document.createElement(e)),a=(n="display",(r=(t=o).style.display)||(r=window.getComputedStyle?window.getComputedStyle(t,null)[n]:t.currentStyle[n]),r);return document.body.removeChild(o),a}function i(e,t){var n,r,o,a,i,c;e&&e.style&&(a="olddisplay",(o=e).bData=o.bData||{},r=o.bData[a],n=e.style.display,t?(r||"none"!==n||(n=e.style.display=""),""===n&&(r=u(e,"olddisplay",(i=e.nodeName,(c=s[i])||(c=l(i),s[i]=c),c)))):n&&"none"!==n&&u(e,"olddisplay",n),t&&"none"!==n&&""!==n||(e.style.display=t?r||"":"none"))}return e}),Air.Module("B.directive.exist",function(require){var r=require("B.util.node"),a=(require("B.event.events"),require("B.util.util"),"b-exist"),e=function(e,t,n){r(e).hasAttribute(a)&&function(t,e,n){e.scope;var r=e.name,o=t.getAttributeNode(a);{if(!o.nodeValue)return;o.nodeValue="{{("+o.nodeValue+")}}"}n(o.nodeValue,o,r,function(e){e&&function(e){if(!e)return;var t=e.parentElement;t&&t.removeChild(e)}(t)},!0)}(e,t,n)};return e.key=a,e}),Air.Module("B.directive.style",function(require){var r=require("B.util.node"),s=(require("B.event.events"),require("B.util.util"),"b-style");return function(e,t,n){r(e).hasAttribute(s)&&function(t,e,n){e.scope;for(var r=e.name,o=t.getAttributeNode(s),a=o.nodeValue.match(/{{.*?}}/g)||[],i=0;i<a.length;i++){var c=a[i];n(c,o,r,u)}function u(e){t.style.cssText=e}}(e,t,n)}}),Air.Module("B.directive.property",function(require){var r=require("B.util.node"),s=(require("B.event.events"),require("B.util.util")),l="b-property";return function(e,t,n){r(e).hasAttribute(l)&&function(o,e,a){for(var i=e.scope,c=e.name,u=o.getAttributeNode(l),t=function(e){var o=[];return e.replace(/(\w+)\s*:\s*([^,}\s]+)/g,function(e,t,n){var r={name:t,dataPath:n};o.push(r)}),o}(o.getAttribute(l)),n=0;n<t.length;n++){var r=t[n];!function(t,n){var e=s.getData(t,i);void 0!==e&&(o[n]=e);var r="{{"+t+"}}";a(r,u,c,function(){var e=s.getData(t,i);o[n]=e})}(r.dataPath,r.name)}}(e,t,n)}}),Air.Module("B.directive.model",function(require){var i=require("B.util.node"),f=require("B.util.util"),c=(require("B.event.events"),"b-model");var e=function(n,e,t){var p=e.scope,r=e.name;if(i(n).hasAttribute(c)){var o=n.getAttributeNode(c),v=n.getAttribute(c).replace(/{{|}}/gi,"");void 0!==f.getData(v,p)&&a(),beacon(n).on("input",d),beacon(n).on("change",d),t("{{"+v+"}}",o,r,a)}function d(e){var t,n=this;if("checkbox"===n.type){var r=n.getAttribute("b-model");if(t=f.getData(r,p),beacon.utility.isType(t,"Array")){var o=beacon.utility.arrayIndexOf(t,n.value);n.checked?t.push(n.value):0<=o&&t.splice(o,1);n.nodeName.toLowerCase(),n.getAttribute("name"),b.views.getActive().getDom()}else t=n.checked}else t=n.value;a=t,i=p,c=v.split("."),u=c.pop(),(s=c.join("."))?f.getData(s,i)[u]=a:i[u]=a;var a,i,c,u,s,l="input"===e.type?"change":"input";beacon(n).off(l,d)}function a(){var e=f.getData(v,p);if(n.value!==e||"radio"===n.type){var t=f.isEmpty(e)?"":e;if(beacon.utility.isType(e,"Array"))(function(e,t,n,r){for(var o=(r=r||document).querySelectorAll(n),a=0;a<o.length;a++){var i=o[a];0<=beacon.utility.arrayIndexOf(e,i.value)?i.checked=!0:i.checked=!1}})(t,0,n.nodeName.toLowerCase()+"[name="+n.getAttribute("name")+"]",b.views.getActive().getDom());else n.value===e&&"radio"!=n.type||(n.initValue=t,"file"!==n.type&&("radio"==n.type?n.checked=n.value==t:(n.checked=t,n.value=t)))}else n.initValue=e}};return e.key=c,e}),Air.Module("B.scope.Scope",function(require){require("B.event.events"),require("B.util.util");var t=function(e){this.parent=e};return function(e){return t.prototype=e||{},new(t.prototype.constructor=t)(e)}}),Air.Module("B.scope.ScopeTreeManager",function(require){var a=require("B.scope.Scope");return function(){function o(e){void 0===e&&(e={}),this.scopeMap={};var t=o.getStructure();t.scope=e,this.rootScope=t}return o.getStructure=function(){return{scope:null,pn:null,name:null}},o.prototype.getScope=function(e){return this.getScopeByName(e)},o.prototype.getRoot=function(){return this.rootScope},o.prototype.setRootScope=function(e){this.rootScope.scope=e},o.prototype.addScope=function(e,t){var n=this.getScope(e)||this.rootScope,r=o.getStructure();return(this.scopeMap[t]=r).scope=new a(n.scope),r.pn=e,r.name=t},o.prototype.getScopeByName=function(e){return this.scopeMap[e]},o.prototype.getScopeInstanceByName=function(e){return(this.getScope(e)||{}).scope},o}()}),Air.Module("B.directive.Repeater",function(require){var n,R=require("B.util.util");function N(e,t,n,r){var o=new RegExp("\\b("+r+")\\b","g"),a=new RegExp("\\b"+n+"\\.\\d+\\.\\$index\\b","g"),i=new RegExp("{{\\b"+n+"\\.\\d+\\.\\$index\\b}}","g"),c=e.replace(/\{\{.*?\}\}|b-show\s*=\s*"[^"]*?"|b-exist\s*=\s*"[^"]*?"|b-model\s*=\s*"[^"]*?"|b-property\s*=\s*"[^"]*"|b-repeat\s*=\s*"[^"]*"/g,function(e){return e.replace(o,n+"."+t)});return c=(c=c.replace(i,t)).replace(a,t)}return Array.prototype.unshift=(n=Array.prototype.unshift,function(e){var t=JSON.stringify(this[this.length-1]);return this[this.lenght]={},n.call(this,e),t&&(this[this.length-1]=JSON.parse(t)),this.length}),function(e,y,t,E){var p=t.scope,v=0,d=function(e){if(e.placeholder)return e.placeholder;var t=document.createComment("repeat placeholder "+e.getAttribute("b-repeat"));return e.parentNode.insertBefore(t,e),e.placeholder=t}(e),n=e.getAttribute("b-repeat").match(/(\S+)\s+in\s+(\S+)/)||[],f=n[2],h=n[1],g=e.outerHTML,r=e.parentNode,m=(e.innerHTML,r.tagName.toLowerCase());r.removeChild(e);var o=function(e){for(var t="",n=document.createDocumentFragment(),r=[],o=0;o<e;o++){var a=v+o;t=N(g,a,f,h);var i=document.createElement(m);i.innerHTML=t;var c=i.firstChild;c.removeAttribute("b-repeat"),c.$index=a,n.appendChild(c),r.push(c)}var u,s,l="select"===m,p=d.parentNode;return l&&(u=p.initValue),p.insertBefore(n,d),l&&setTimeout(function(){p.value=u},0),s=d,"option"==c.nodeName.toLowerCase()&&setTimeout(function(){s.parentNode.value=s.parentNode.initValue},0),i=n=null,v+=e,r},a=function(e){for(var t=e.previousSibling;t&&1!==t.nodeType;)t=t.previousSibling;return t},w=[];function S(e,t,n){for(var r="",o=t.split(".")||[],a=0;a<o.length;a++){var i=o[a],c=r?R.getData(r,p):p;c=c||Air.NS(r,p);var u=i&&R.getData(i,c),s=Object.getOwnPropertyDescriptor(c,i);s&&s.get&&w.indexOf(s)<0&&w.push(s),n&&beacon(p).on("updateRepeatData"+o.slice(0,a+1).join(""),function(e,t){S(T,t.dataPath),t.callback&&t.callback()});var l=b.call(c,e,u,o.slice(0,a+1).join("."));"object"==typeof c&&(a===o.length-1||!s||!s.get)&&Object.defineProperty(c,i,l),r=i&&r?r+"."+i:i}}function b(f,h,g){var m=0;h=h||[];var b={enumerable:!0,configurable:!0,get:function(){return setTimeout(function(){var e=h&&h.length||0;if(m!==e){for(var t=f.updateUI(),n=0;n<t.length;n++){var r=t[n];r&&E(r,y,y)}for(n=0;n<w.length;n++)w[n]&&w[n].get&&w[n].get()}m=e},0),h},set:function(e,t){var n=h!==e;e||(e=beacon.utility.isType(h,"Array")?[]:{});var r,o=beacon.utility.isType(e,"Array"),a=beacon.utility.isType(e,"Object");if(n)if(a){for(var i in h=h||{})e[i]||(e[i]=void 0);for(var i in h){var c=Object.getOwnPropertyDescriptor(h,i);c&&c.get||(beacon.utility.isType(h[i],"Array")?S(f,g+"."+i,!0):beacon.utility.isType(h[i],"Object")&&beacon.on("updateObjectData",{currentScopeIndex:y,dataPath:g+"."+i}))}t||beacon.utility.merge(h,e)}else if(o){if(r=b,(h=h||[]).unshift=function(e){var t=[].concat(e,this);return r.set([]),r.set([].concat(t)),t},!t){var u=h.length,s=e.length;if(0===e.length)h.splice(0);else for(var i in h){var l=parseInt(i,10);beacon.utility.isType(l,"Number")&&!isNaN(l)||e[i]||(e[i]=void 0)}s<u&&h.splice(s-u,u-s),m=s,beacon.utility.merge(h,e)}for(var p=f.updateUI(),v=0;v<p.length;v++){var d=p[v];d&&E(d,y,y)}}else h=e}};return b}var T={updateUI:function(e){var t,n=(t=e,((R.getData(t||f,p)||[]).length||0)-v),r=0<n;return n<0&&function(e){e=Math.abs(e);for(var t=0;t<e;t++){var n=a(d);n&&d.parentNode.removeChild(n)}v-=e}(n),r&&o(n)},getDataPrefix:function(){return h}};return S(T,f,!0),T}}),Air.Module("B.scope.tagManager",function(require){var util=require("B.util.util"),nodeMap=[];function addNode(e,t,n,r){nodeMap[e]=nodeMap[e]||{},nodeMap[e][t]=nodeMap[e][t]||[],nodeMap[e][t].push({element:n,template:n.$template,callback:r})}function getNodes(e,t){var n=nodeMap[e];return n&&n[t]||[]}function updateNodeValue(scopeIndex,scope,token,callback){for(var nodes=getNodes(scopeIndex,token),_loop_1=function(i){var activeNode=nodes[i],newValue=activeNode.element.$template.replace(/{{(.*?)}}/g,function(tag,expression){return eval(expression)||""}),ownerElement=activeNode.element.ownerElement;ownerElement&&"option"===ownerElement.nodeName.toLowerCase()&&ownerElement.parentNode&&setTimeout(function(){ownerElement.parentNode&&(ownerElement.parentNode.value=ownerElement.parentNode.initValue)},0),activeNode.element.nodeValue=newValue,activeNode.callback&&activeNode.callback(newValue)},i=0;i<nodes.length;i++)_loop_1(i)}var api={addNode:addNode,getNodes:getNodes,updateNodeValue:updateNodeValue};return api}),Air.Module("B.scope.scopeManager",function(require){var rootScope={},ScopeTreeManager=require("B.scope.ScopeTreeManager"),initModel=require("B.directive.model"),eventDirective=require("B.directive.event"),showDirective=require("B.directive.show"),existDirective=require("B.directive.exist"),styleDirective=require("B.directive.style"),propertyDirective=require("B.directive.property"),Repeater=require("B.directive.Repeater"),tagManager=require("B.scope.tagManager"),util=require("B.util.util"),nodeUtil=require("B.util.node"),memCache=require("B.data.memCache"),scopeTreeManager=new ScopeTreeManager;function isView(e){return util.isHTML(e)&&"VIEW"==e.nodeName.toUpperCase()}function isRepeat(e){return util.isHTML(e)&&e.hasAttribute("b-repeat")}var backtrackingPoints=[];function bindObjectData(e,t,n){for(var r=(scopeTreeManager.getScope(t)||scopeTreeManager.getRoot()).scope,o="",a=e.split(".")||[],i=0;i<a.length;i++){var c=a[i],u=o?util.getData(o,r):r;u=u||Air.NS(o,r);var s=c&&util.getData(c,u);c&&(!Object.getOwnPropertyDescriptor(u,c)||!Object.getOwnPropertyDescriptor(u,c).set||/^\d+$/.test(c)||i===a.length-1)&&Object.defineProperty(u,c,createDescriptor.call(u,s,e,t,n)),o=c&&o?o+"."+c:c}}function getTokens(a,i,e){i.$template=i.$template||i.nodeValue;scopeTreeManager.getScope(e);for(var c=a.match(/(['"])\s*([$a-zA-Z\._0-9\s\-]+)\s*\1|(['"])?\s*([$a-zA-Z\._0-9\s]+)\s*\1?/g)||[],u=[],t=function(e){var r=util.trim(c[e]);if(!/^\d+$/.test(r)&&!/^['"]/.test(r)&&""!=r&&"true"!==r&&"false"!==r){var t=new RegExp("(^|\\b).*?("+r.replace(/([.*?+\-^\/$])/g,"\\$1")+")","g"),n=i.$tag||a,o=n.replace(t,function(e,t,n){return 0<=e.indexOf('util.getData("'+r)?e:e.replace(n,'util.getData("'+r+'", scope)')});i.$template=i.$template.replace(n,o),i.$tag=o,u.push(r)}},n=0;n<c.length;n++)t(n);return 0===u.length&&(i.$tag=a),u}function tryGenerateSubViewScope(e,t){if("view"===e.tagName.toLowerCase()){var n=e.getAttribute("b-scope-key"),r=e.getAttribute("name"),o=n||r,a=t.scope,i=t.name;if(!a){var c=scopeTreeManager.addScope(i,o);a=scopeTreeManager.getScope(c)}if(n){var u=(memCache.get("controllerMap")||{})[r];u&&setTimeout(function(){b.run(r,u)},0)}}return t}function createDescriptor(c,u,s,l){var p=scopeTreeManager.getScope(s),e=0;return{enumerable:!0,configurable:!0,get:function(){return beacon.utility.isType(c,"Array")&&setTimeout(function(){e!==c.length&&l&&l(),e=c.length},0),c},set:function(e){var t=c!==e,n=beacon.utility.isType(e,"Array"),r=beacon.utility.isType(e,"Object");if(t&&(n||r)){if(c=c||(n?[]:{}),n){var o=c.length,a=e.length;a<o&&c.splice(a-o,o-a)}if(r)for(var i in c)i in e||(e[i]=void 0);beacon.utility.merge(c,e),n&&l&&l()}else c!==e&&(c=e,tagManager.updateNodeValue(s,p.scope,u))}}}beacon.on("updateObjectData",function(e,t){bindObjectData(t.dataPath,t.currentScopeIndex)});var ScopeManager=function(){function ScopeManager(){this.getScope=function(e){return scopeTreeManager.getScopeByName(e)},this.setRoot=function(e){return scopeTreeManager.setRootScope(e)},this.getScopeInstance=function(e){return scopeTreeManager.getScopeInstanceByName(e)}}return ScopeManager.prototype.parseScope=function(e,t,n){var r=scopeTreeManager.getScopeByName(e);return r||(this.parseTemplate(t,e),r=scopeTreeManager.getScopeByName(e)||{}),r.scope},ScopeManager.prototype.watchData=function(e,t,n,r,o){for(var a=scopeTreeManager.getScope(n),i=getTokens(e,t,n),c=0;c<i.length;c++){var u=i[c];r&&o&&r(util.getData(u,a.scope)),tagManager.addNode(n,u,t,r),bindObjectData(u,n,r)}},ScopeManager.prototype.parseTEXT=function(node,currentScopeIndex){for(var tags=node.nodeValue.match(/{{.*?}}/g)||[],scopeStructure=scopeTreeManager.getScope(currentScopeIndex)||scopeTreeManager.getRoot(),scope=scopeStructure.scope,i=0;i<tags.length;i++){var activeTag=tags[i];if(this.watchData(activeTag,node,currentScopeIndex),node.$tag){var val=eval(node.$tag.replace(/(^{{)|(}}$)/g,""))||"";node.nodeValue=node.nodeValue.replace(activeTag,val),node.$tag=""}}},ScopeManager.prototype.parseHTML=function(e,t){var n=scopeTreeManager.getScope(t)||scopeTreeManager.getRoot();tryGenerateSubViewScope(e,n);var r=n.scope;if(existDirective(e,n,this.watchData),e.parentElement){initModel(e,n,this.watchData),eventDirective(e,r),showDirective(e,n,this.watchData),styleDirective(e,n,this.watchData),propertyDirective(e,n,this.watchData);for(var o=[].concat.apply([],e.attributes),a=0;a<o.length;a++){var i=o[a];-1===[initModel.key,showDirective.key].indexOf(i.name)&&this.parseTEXT(i,t)}}},ScopeManager.prototype.parseViewElement=function(e){return e.lastChild},ScopeManager.prototype.parseTemplate=function(e,t){void 0===t&&(t="root");for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=document.createNodeIterator(e,NodeFilter.SHOW_ALL),a=[],i=[],c=e;do{if(isView(c)){a.push(t);var u=c.lastChild;u&&i.push(u),t=c.getAttribute("b-scope-key")||c.getAttribute("name");var s=a[a.length-2];scopeTreeManager.addScope(s,t)}else if(isRepeat(c)){c.nextSibling;var l=this.createRepeatNodes(c,t);if(l)for(var p=0;p<l.length;p++){var v=l[p];this.parseTemplate(v,t)}}switch(c.nodeType){case nodeUtil.type.HTML:this.parseHTML(c,t);break;case nodeUtil.type.TEXT:case nodeUtil.type.ATTR:this.parseTEXT(c,t)}i[i.length-1]===c&&(i.pop(),t=a.pop())}while(c=o.nextNode())},ScopeManager.prototype.createRepeatNodes=function(e,t){var a=this,n=scopeTreeManager.getScope(t);return new Repeater(e,t,n,function(e,t,n,r,o){a.parseTemplate(e,t,n,r,o)}).updateUI()},ScopeManager}();return new ScopeManager}),Air.Module("B.network.HTTP",function(){var n=4;function e(){var e=new XMLHttpRequest,t=this;e.onreadystatechange=function(){e.readyState===n&&(200<=e.status&&e.status<300||304==e.status||0==e.status&&t.requestURL.match(/^file:/)?t.successCallBack&&t.successCallBack(e):t.errorCallBack&&t.errorCallBack(e))},this.xhr=e}return e.prototype={request:function(e){for(var t in this.requestURL=e.url,this.successCallBack=e.successCallBack,this.errorCallBack=e.errorCallBack,this.xhr.open(e.method,e.url,!0),e.header)this.xhr.setRequestHeader(t,e.header[t]);this.xhr.send(e.data)},get:function(e,t){t=t||{},this.request({method:"GET",url:e,successCallBack:t.successCallBack,errorCallBack:t.errorCallBack})},abort:function(){this.xhr.abort()}},e}),Air.Module("B.service.Request",function(require){var r=require("B.network.HTTP"),i=require("B.event.events"),t=require("B.data.storage"),n=require("B.util.middleware");return function(){function a(e,t,n){void 0===t&&(t={}),this.http=new r,this.options={},this.EVENTS={SUCCESS:beacon.createEvent("service response success"),TIMEOUT:beacon.createEvent("service request timout"),ERROR:beacon.createEvent("service response error"),BIZERROR:beacon.createEvent("business error"),NETWORKERROR:beacon.createEvent("network error")},this.request=e,this.options=t,this.scope=n}return a.callBeforeQueryMiddleware=function(e,t){n.run("beforeQuery",e,t)},a.callAfterQueryMiddleware=function(e,t){n.run("afterQuery",e,t)},a.prototype.sendRequest=function(e){var t=this;void 0===e&&(e=this.request),a.callBeforeQueryMiddleware(e,function(){e.successCallBack=function(e){t.httpSuccessCallback(e)},e.errorCallBack=function(e){t.httpErrorCallback(e)},t.http.request(e),t.startTimeoutCount()})},a.prototype.startTimeoutCount=function(){var e=this;this.timer=setTimeout(function(){e.http.abort()},1e3*this.options.timeout)},a.prototype.clearTimeoutCount=function(){clearTimeout(this.timer)},a.prototype.parseResponseError=function(e){var t=this,n={xhr:this.http.xhr,data:e,requestParam:this.request,errorCode:a.ERROR_CODE.parse};a.callAfterQueryMiddleware(n,function(e){t.options.errorCallBack&&t.options.errorCallBack(a.ERROR_CODE.parse),beacon(t).on(t.EVENTS.ERROR,{error:a.ERROR_CODE.parse,errorType:"response parse error"}),beacon(t.scope).on(i.DATA_CHANGE)})},a.prototype.cacheResponse=function(e){this.options.expiredSecond&&t.set(this.options.cacheKey,e,{expiredSecond:this.options.expiredSecond})},a.prototype.responseComplate=function(n,r){var o=this,e={xhr:this.http.xhr,data:n,requestParam:this.request};a.callAfterQueryMiddleware(e,function(e){if(e){o.options.errorCallBack&&o.options.errorCallBack(a.ERROR_CODE.business,n);var t={error:a.ERROR_CODE.business,errorType:"business error",response:n};return beacon(o).on(o.EVENTS.ERROR,t),void beacon(o).on(o.EVENTS.BIZERROR,t)}o.cacheResponse(r),o.options.successCallBack&&o.options.successCallBack(n),beacon(o).on(o.EVENTS.SUCCESS,n),beacon(o.scope).on(i.DATA_CHANGE)})},a.prototype.httpSuccessCallback=function(e){void 0===e&&(e={}),this.clearTimeoutCount();var t,n="";if(4===e.readyState){n=e.responseText;try{t=JSON.parse(n),this.responseComplate(t,n)}catch(e){return void this.parseResponseError(t)}}},a.prototype.httpErrorCallback=function(e){var t=this;this.clearTimeoutCount();var n=e.status?a.ERROR_CODE.network:a.ERROR_CODE.timeout,r=(e.status,{errorCode:n,xhr:e,requestParam:this.options});a.callAfterQueryMiddleware(r,function(e){t.options.errorCallBack&&t.options.errorCallBack(n,e),beacon(t).on(t.EVENTS.ERROR,{error:n,response:e})}),beacon(this.scope).on(i.DATA_CHANGE)},a.ERROR_CODE={parse:1,timeout:2,network:3,business:4},a}()}),Air.Module("B.service.Service",function(require){require("B.network.HTTP");var o=require("B.data.storage"),c=require("B.service.Request");return function(){function e(e,t){void 0===e&&(e={}),this.requestQueue=[],this.EVENTS={SUCCESS:beacon.createEvent("service response success"),TIMEOUT:beacon.createEvent("service request timout"),ERROR:beacon.createEvent("service response error"),BIZERROR:beacon.createEvent("business error"),NETWORKERROR:beacon.createEvent("network error")},this.config=e,this.scope=t,this.config.header=this.config.header||{},this.config.header["Content-Type"]=this.config.header["Content-Type"]||"application/json;charset=utf-8"}return e.prototype.on=function(e,t){beacon(this).on(e,t)},e.prototype.off=function(e,t){beacon(this).off(e,t)},e.prototype.getConfig=function(){return this.config},e.prototype.responseCacheData=function(e,t){if(e){return t.successCallBack&&t.successCallBack(e,!0),void beacon(this).on(this.EVENTS.SUCCESS,e)}},e.prototype.getCacheData=function(e){var t,n=this.config.protocol+"://"+this.config.host+this.config.path+JSON.stringify(e),r=o.get(n);try{t=JSON.parse(r)}catch(e){}return t},e.prototype.query=function(e,t){void 0===t&&(t={});var n=this.config.protocol+"://"+this.config.host+this.config.path,r=n+JSON.stringify(e),o=this.getCacheData(e);if(!t.noCache&&o)this.responseCacheData(o,t);else{var a={url:n,method:this.config.method,header:this.config.header,data:JSON.stringify(e),serviceName:this.config.serviceName};t.timeout=t.timeout||this.config.timeout,t.expiredSecond=t.expiredSecond||this.config.expiredSecond,t.cacheKey=r;var i=new c(a,t,this.scope);this.bindRequestEvent(i),this.requestQueue.push(i),i.sendRequest()}},e.prototype.bindRequestEvent=function(e){var n=this;beacon(e).on(e.EVENTS.SUCCESS,function(e,t){beacon(n).on(n.EVENTS.SUCCESS,t)}),beacon(e).on(e.EVENTS.TIMEOUT,function(e,t){beacon(n).on(n.EVENTS.TIMEOUT,t)}),beacon(e).on(e.EVENTS.BIZERROR,function(e,t){beacon(n).on(n.EVENTS.BIZERROR,t)}),beacon(e).on(e.EVENTS.NETWORKERROR,function(e,t){beacon(n).on(n.EVENTS.NETWORKERROR,t)}),beacon(e).on(e.EVENTS.ERROR,function(e,t){beacon(n).on(n.EVENTS.ERROR,t)})},e.prototype.abort=function(e){for(var t=0;t<this.requestQueue.length;t++){this.requestQueue[t].abort()}},e.serviceQueue={},e}()}),Air.Module("B.service.serviceFactory",function(require){var r=require("B.service.Service"),n=require("B.util.middleware");return new(function(){function e(){this.configList=[],this.serviceList=[]}return e.prototype.getConfig=function(e){return this.configList[e]||{}},e.prototype.addMiddleware=function(e,t){n.add(e,t)},e.prototype.removeMiddleware=function(e,t){n.remove(e,t)},e.prototype.setConfig=function(e,t){e&&(this.configList[e]=t)},e.prototype.set=function(e,t){if(!e)throw new Error("serviceName is required");var n=beacon.utility.merge({},this.getConfig(t.extend),t);this.serviceList[e]=n},e.prototype.get=function(e,t){var n=this.serviceList[e];if(n)return n.serviceName=e,new r(n,t);throw new Error(e+" not found")},e.prototype.abortAll=function(){for(var e in this.serviceList){if(this.serviceList.hasOwnProperty(e))this.serviceList[e].abort(!0)}},e}())}),Air.Module("B.router.router",function(){return new(function(){function i(){this.routers=[]}return i.getURLByRule=function(e,n,t,r){var o,a=e.replace(/:(\w+)/gi,function(e,t){return n[t]||""});return location.origin||(o=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")),a=(r?"":location.origin||o)+a+t},i.tryMatchParams=function(e,t){var n,r=t.match(e.reg);if(r){n={rule:e.rule,viewName:e.viewName,params:{}};for(var o=r.length,a=1;a<o;a++){var i=e.params[a-1];n.params[i]=r[a]}}return n},i.parseRule=function(e){var t=[],n=e.replace(/:[\w-]+/gi,function(e){return t.push(e.replace(":","")),"([\\w-]+)"});return{reg:new RegExp("^"+n+"/*$","i"),params:t}},i.prototype.set=function(e){var t=i.parseRule(e.rule),n={rule:e.rule,viewName:e.viewName,sign:e.sign,reg:t.reg,params:t.params};this.routers.push(n),this.routers[e.viewName]=n},i.prototype.getMatchedRouter=function(e){for(var t=this.routers.length,n=0;n<t;n++){var r=this.routers[n],o=i.tryMatchParams(r,e);if(o)return o}return null},i.prototype.getURLPathByViewName=function(e,t){var n=(t=t||{}).params||{},r=t.query||"";r=t.hash?r+t.hash:r;var o=this.routers[e],a=o&&o.rule||"";return i.getURLByRule(a,n,r,t.noOrigin)},i.prototype.get=function(e){return this.routers[e]||{}},i}())}),Air.Module("B.view.View",function(require){var c=require("B.scope.scopeManager");require("B.event.events");return function(){function i(e,t,n){if(void 0===n&&(n={}),this.initQueue=[],this.showBeforeQueue=[],this.showAfterQueue=[],this.hideQueue=[],this.events={onShow:beacon.createEvent("view onShow"),onHide:beacon.createEvent("view onHide")},this.show=function(){this.dom.setAttribute("active","true")},this.hide=function(){this.dom.removeAttribute("active")},this.getDom=function(){return this.dom},this.viewName=e,beacon.isType(t,"String")){var r=i.createDomByString(t);this.dom=r.querySelector('view[name="'+e+'"]'),i.parseTag("style",e,r,function(e){i.loadStyle(e,t)}),i.parseTag("script",e,r,function(e){i.loadScript(e,t,n.initCallback)})}else this.dom=t}return i.createDomByString=function(e){var t=document.createElement("div");return"undefined"==typeof DOMParser?t.innerHTML="X<div></div>"+e:t.innerHTML=e,t},i.loadStyle=function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];t.appendChild(o)}},i.loadScript=function(e,t,n){setTimeout(function(){i.runJS(e,t)},0),n&&n()},i.runJS=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=document.createElement("script"),a=r.src;r.parentNode&&r.parentNode.removeChild(r),a?Air.loadJS(a):(o.text=r.text,t.appendChild(o))}},i.splitDom=function(e,t){var n=e.getElementsByTagName(t);return n=[].concat.apply([],n)},i.parseTag=function(e,t,n,r){var o=i.splitDom(n,e);o=[].concat.apply([],o);for(var a=0;a<o.length;a++){c.parseScope(t+e,o[a],!0);r&&r(o)}},i.prototype.getViewName=function(){return this.viewName},i.prototype.parseSrc=function(){var e=this.dom.querySelectorAll("[b-src]");if(e)for(var t=0,n=e.length;t<n;t++){var r=e[t],o=r.getAttribute("b-src");o&&r.setAttribute("src",o)}},i}()}),Air.Module("B.view.viewManager",function(require){var c=require("B.view.View"),u=require("B.router.router"),s=require("B.network.HTTP"),l=require("B.data.memCache"),p=require("B.scope.scopeManager"),v=require("B.event.events"),o=require("B.util.middleware"),d={loadingHandle:null,showLoading:function(){d.loadingHandle&&d.loadingHandle.show()},hideLoading:function(){d.loadingHandle&&d.loadingHandle.hide()},setLoading:function(e){d.loadingHandle=e},unsetLoading:function(){d.loadingHandle=null}};return new(function(){function e(){this.loading=d,this.loadingViewList=[]}return e.prototype.setMainViewport=function(e){this.mainViewport=e},e.prototype.initLocalView=function(e){for(var t=e.dom.children,n=t.length,r=0;r<n;r++){var o=t[r];if("view"===o.tagName.toLowerCase()){var a=o.getAttribute("name"),i=new c(a,o);e.views[a]=i,p.parseScope(a,i.getDom())}}},e.prototype.getViewByViewName=function(e){return this.mainViewport.views[e]},e.prototype.appendView=function(e,t){this.mainViewport.dom.appendChild(t.getDom()),this.mainViewport.views[e]=t},e.prototype.changeURLParams=function(e,t){if(void 0===t&&(t={}),!t.isComponent){var n=p.getScopeInstance(e);n.$request=n.$request||{},n.$request.params=t.params}},e.prototype.getURL=function(e,t){return u.getURLPathByViewName(e,{params:t.params,query:t.query,hash:t.hash})},e.prototype.switchURL=function(e,t){if(void 0===t&&(t={}),!t.isComponent){var n=this.getURL(e,t),r=t.replace;if(history.pushState&&history.replaceState){var o=r?history.replaceState:history.pushState;o&&o.call(history,{viewName:e,params:t.params,hash:t.hash},e,n)}else r?!t.init&&location.replace(n):location.href=n;this.runURLChangeMiddleWare()}},e.prototype.runURLChangeMiddleWare=function(){o.run("afterURLChange")},e.prototype.listenURLChange=function(){var o=this;beacon(window).on("popstate",function(e){var t=e.state||{};if(o.saveLastView(),t.viewName)if(o.getViewByViewName(t.viewName))o.changeURLParams(t.viewName,t),o.show(t.viewName),o.runURLChangeMiddleWare();else{var n=location.pathname,r=u.getMatchedRouter(n);r?o.goTo(r.viewName,{replace:!0,params:r.params,query:location.search,hash:location.hash}):o.throw404()}})},e.prototype.show=function(e){var t=this.getViewByViewName(e);t?(t.parseSrc(),this.switchView(t)):this.throw404()},e.prototype.throw404=function(){o.run("viewNotFound")},e.prototype.saveLastView=function(){this.lastView=this.getActive()},e.prototype.setActive=function(e){this.activeView=e},e.prototype.switchView=function(e){var t="";this.lastView&&(t=this.lastView.getViewName(),this.triggerOnHide(this.lastView,e)),this.setActive(e),this.activeView.show(),this.triggerOnShow(this.activeView,t),d.hideLoading()},e.prototype.triggerOnHide=function(e,t){var n=e.getViewName();e&&e.hide(),beacon(e).on(e.events.onHide,{to:t});var r=p.getScopeInstance(n);beacon(r).on(v.DATA_CHANGE)},e.prototype.triggerOnShow=function(e,t){var n=e.getViewName();n!==t&&beacon(e).on(e.events.onShow,{from:t});var r=p.getScopeInstance(n);beacon(r).on(v.DATA_CHANGE)},e.prototype.initLocalViewport=function(){for(var e=[],t=document.querySelectorAll("viewport"),n=t.length,r=0;r<n;r++){var o=t[r],a="true"===o.getAttribute("main"),i={dom:o,views:{}};e.push(i),a&&this.setMainViewport(i),this.initLocalView(i)}},e.prototype.loadView=function(o,a){var i=this;void 0===a&&(a={}),d.showLoading();var e=l.get("env"),t=u.get(o).sign||"",n=t?"_"+t:"",r=(a.templatePath||e.$templatePath)+o+n+".html";(new s).get(r,{successCallBack:function(e){var t=e.responseText,n=new c(o,t,{initCallback:function(){}}),r=p.parseScope(o,n.getDom());i.changeURLParams(o,a),i.appendView(o,n),i.saveLastView(),i.setActive(n),beacon(r).once(v.RUN_COMPLETE,function(){i.switchURL(o,a),i.show(o),i.removeLoadingView(o)})},errorCallBack:function(){i.throw404()}})},e.prototype.viewIsLoading=function(e){return!this.loadingViewList.indexOf(e)},e.prototype.addLoadingView=function(e){-1===beacon.utility.arrayIndexOf(this.loadingViewList,e)&&this.loadingViewList.push(e)},e.prototype.removeLoadingView=function(e){var t=beacon.utility.arrayIndexOf(this.loadingViewList,e);-1!==t&&this.loadingViewList.splice(t,1)},e.prototype.goTo=function(t,n){var r=this,e={viewName:t,options:n};o.run("beforeGoTo",e,function(){var e=r.getViewByViewName(t);r.viewIsLoading(t)||(e?(r.saveLastView(),r.switchURL(t,n),r.changeURLParams(t,n),r.show(t)):(r.addLoadingView(t),r.loadView(t,n)))})},e.prototype.jump=function(e){var t=e.url||"",n=e.project||"",r=e.urlPath||"",o=e.query||"";n=n.replace(/^\//,"");var a=new RegExp("^(/)?("+n+"[/|$])?");r=r.replace(a,""),location.href=t||"/"+(n||"")+"/"+(r||"")+(o||"")},e.prototype.back=function(){window.history.back()},e.prototype.addMiddleware=function(e,t){o.add(e,t)},e.prototype.removeMiddleware=function(e,t){o.remove(e,t)},e.prototype.getActive=function(){return this.activeView},e.prototype.getScopeKeyByViewName=function(e){var t=this.activeView.getDom().querySelector('view[name="'+e+'"]');return t&&t.getAttribute("b-scope-key")||""},e.prototype.getTemplate=function(n,r){void 0===r&&(r={});var e=l.get("env"),t=(r.path||e.$templatePath)+r.templatePath.replace(/\./g,"/")+".html",o=r.errorCallBack||function(){},a=this.templateCache[n];if(a)return a;(new s).get(t,{successCallBack:function(e){var t=e.responseText;this.templateCache[n]=t,r.onSuccess&&r.onSuccess(t)},errorCallBack:o})},e.prototype.init=function(e){p.setRoot(e),this.initLocalViewport();var t=location.pathname,n=u.getMatchedRouter(t),r=location.hash;n?this.goTo(n.viewName,{replace:!0,init:!0,params:n.params,query:location.search,hash:r}):this.throw404(),this.listenURLChange()},e}())}),Air.Module("B.controller.run",function(require){var u=require("B.data.memCache");return function(e,t){var n=require("B.scope.scopeManager"),r=require("B.view.viewManager"),o=require("B.event.EVENTS"),a=r.getScopeKeyByViewName(e),i=n.getScopeInstance(a||e);if(a){var c=u.get("controllerMap");c||(c={},u.set("controllerMap",c)),c[e]=t,u.set("controllerMap",c)}Air.run(t,!1,i),Air.run(function(){beacon(i).on(o.DATA_CHANGE,i),beacon(i).on(o.RUN_COMPLETE)})}}),Air.Module("B.TDK.TDK",function(){var o=document.head||document.getElementsByTagName("head")[0];function n(e){var t,n,r=o.querySelector("meta[name="+e+"]");return r=r||(t=e,(n=document.createElement("meta")).setAttribute("name",t),o.appendChild(n),n)}return{setTitle:function(e){return document.title=e||document.title,document.title},setDescription:function(e){var t=n("description");return t.content=e||t.content,t.content},setKeywords:function(e){var t=n("keywords");return t.content=e||t.content,t.content}}}),Air.run(function(require){var t=require("B.view.viewManager"),n=require("B.scope.scopeManager"),r=require("B.router.router"),o=require("B.data.memCache"),a=require("B.controller.run"),i=require("B.service.serviceFactory"),c=require("B.network.HTTP"),u=require("B.data.storage"),s=require("B.TDK.TDK"),e=function(){function e(){this.FRAMEWORK_NAME="b",this.views=t,this.router=r,this.scopeManager=n,this.service=i,this.run=a,this.Module=Air.Module,this.TDK=s,this.bridge={run:function(){},isHybrid:!1,isInApp:!1},this.utility={storage:u,HTTP:c}}return e.prototype.init=function(e){void 0===e&&(e={}),o.set("env",e),Air.moduleURL(e.$moduleURL),t.init(e)},e.prototype.ready=function(e){void 0===e&&(e=function(){}),Air.domReady(function(){e()})},e.prototype.setModuleURL=function(e){Air.moduleURL(e)},e}();window.b=new e});