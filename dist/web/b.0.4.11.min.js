!function(a){function b(a){this.target=a}var c=a.beacon,d=function(c){return this!==a&&d.blend(this,d),new b(c)};d.toString=function(){return"baishuiz@gmail.com"};var e={base:f,avatarCore:b.prototype,self:f,init:function(){var b=Object.freeze;a.beacon=d,e.merge(d,f),delete a.beacon.base,b&&b(d)},login:function(){a.beacon=d},logoff:function(){a.beacon=c}},f={base:e};a.beacon=f}(this),function(a){var b=a.base||{},c={merge:function(a){for(var b=arguments.length,c=1;b>c;c++){var d=arguments[c];for(var e in d)a[e]=d[e]}return a},blend:function(a,b,d){var e={cover:!0,mergePrototype:!1,reset:!1};if(d=d?c.merge(e,d):e,b=[].concat(b),d.reset)for(var f in a)b[0][f]||(b[0][f]=void 0);for(var g=b.length,h=0;g>h;h++){var i=b[h];for(var j in i){var k=d.mergePrototype||i.hasOwnProperty(j),l=d.cover||!a[j];k&&l&&(a[j]=i[j])}}return a},isType:function(a,b){return"Null"===b&&null===a||"Undefined"===b&&void 0===a||"Number"===b&&isFinite(a)||Object.prototype.toString.call(a).slice(8,-1)===b},arrayIndexOf:function(a,b){return c.arrayIndexOf=Array.prototype.indexOf?function(a,b){return a=[].slice.call(a,0),a.indexOf(b)}:function(a,b){a=[].slice.call(a,0);for(var c=a.length;c>=0;c--)if(a[c]===b)return c;return c},c.arrayIndexOf(a,b)},each:function(a,b){if(a){a=[].concat(a);for(var c=0;c<a.length;c++)b.call(a[c],c,a[c])}}};c.blend(b,c)}(beacon),function(a){var b=a.base,c=function(a){function c(a){var b=e(f,a);0>b&&(b=f.push(a)-1);var c="event_"+b;return a.toString()===a?a:c}function d(a){return 0>e(f,a)?null:c(a)}var e=b.arrayIndexOf,f=[];return{dom:a,target:a,attachEvent:function(a,b){var d=c(a);f[d]=f[d]||[],f[d].push(b)},removeEvent:function(a,b){var d,e=a&&c(a),g=e&&f[e];if(a&&b)for(var h=g.length-1;h>=0;h--){var i=g[h];i===b&&(d=f[e].splice(h,1))}else a&&!b?(d=f[e],f[e]=[]):a||b||(d=f,f=[]);return d},getEventList:function(a){var b;if(!a)return f.slice(0);var c=d(a);return c&&(b=a?f[c]:f.slice(0)),b}}};b.EventStructure=c}(beacon),function(a){function b(a){var b=new j(a);return h.push(b),b}function c(a,c,d){(g(a)||b(a)).attachEvent(c,d)}function d(a,b,d){var e=b.registEvent(d),f=b.getEventList();i.each(f,function(b){c(a,f[b],e)})}function e(a,b,c){var d=h.slice(0),e=a?g(a)||[]:h.slice(0);i.each(e,function(a,e){if(e.removeEvent(b,c),!b&&!c||0==e.getEventList().length){var a=i.arrayIndexOf(h,e);d.splice(a,1)}}),h=d}function f(a,b,c){var d=b.removeEvent(c);i.each(d,function(c){var f=d[c],g=b.getEventList();i.each(g,function(b,c){e(a,c,f)})})}function g(a){if(!a)return h.slice(0);for(var b=0;b<h.length;b++){var c=h[b];if(c.target===a)return c}}var h=[],i=a.base,j=i.EventStructure,k={registEvent:c,registCombinationEvent:d,removeEvent:e,removeCombinationEvent:f,getEventList:g};i.eventStore=k}(beacon),function(a){function b(){if(this instanceof b)return this;var a=[],d=[],e=[].slice.call(arguments,0),f=e.slice(0),g=function(){function b(){return f=e.slice(0)}var g=function(b,e){0>c.arrayIndexOf(a,b)&&(a.push(b),d.push(e))},h=function(b){var e=c.arrayIndexOf(a,b),f=d[e];return b?f:d.slice(0)};this.resetEventList=b,this.getEventList=function(){return e.slice(0)},this.registEvent=function(a){var d=c.arrayIndexOf,f=e.slice(0),h=function(c,e){var g=this,h=d(f,c.eventType);h>=0&&f.splice(h,1),0===f.length&&(a.call(g,e),f=b())};return g(a,h),h},this.removeEvent=function(a){return[].concat(h(a))}};return g.prototype=new b,new g}var c=a.base;c.combinationalEvent=b}(beacon),function(a){var b=a.base,c=b.eventStore,d=c.registCombinationEvent,e=c.registEvent,f=c.removeCombinationEvent,g=c.removeEvent,h=c.getEventList,i={hostProxy:{},attachActionEvent:function(a,c,d){var e=a.desc,f=b.isType(a.desc,"Function");f&&e(c,d);var g=["touchmove","mousemove"];b.each(g,function(b,c){f&&window.beacon(document).on(c,function(b){i.publicDispatchEvent(a,b)})})},attachEvent:function(a,c){var f=this,g=a instanceof b.combinationalEvent?d:e;i.attachActionEvent(a,f,c),g(f,a,c)},fireEvent:function(a,c){var d=this,e=h(d);if(e){var f=e.getEventList(a),g=b.isType(a.desc,"Function");!!(g&&a.desc(c))==!!g&&b.each(f,function(b,e){var f={eventType:a};e.call(d,f,c)})}},publicDispatchEvent:function(a,c){var d=h();b.isType(a.desc,"Function")&&a.desc(c),b.each(d,function(b){var e=d[b].dom;i.fireEvent.call(e,a,c)})},removeEvent:function(a,c){var d=this;(a instanceof b.combinationalEvent?f:g)(d,a,c)}},j=function(){var a=function(){};return a.prototype=i,b.blend(a,i),a}();b.Event=j}(beacon),function(a){var b=a.base,c=function(){return this}(),d=b.EventStructure,e={structures:[],getStructure:function(a){for(var b,c,d=0;d<e.structures.length;d++){b=e.structures[d];try{c=b.dom===a}catch(f){b.dom=window.document,c=b.dom===a}if(c)return b}},add:function(a,b,c){var f=e.getStructure(a);f||(f=new d(a),e.structures.push(f)),f.attachEvent(b,c)},remove:function(a,b,c){var d=e.getStructure(a);return d&&d.removeEvent(b,c)}},f={attachEvent:function(a,b){var d,e=this,g=function(a,b){this.addEventListener(a,b,!1)},h=function(a,b){this.attachEvent("on"+a,b)},i=function(a,b){var c=this,d=c["on"+a];c["on"+a]=function(){d.call(c),b.call(c)}};return c.addEventListener?(g.call(e,a,b),d=g):c.attachEvent?(h.call(e,a,b),d=h):(i.call(e,a,b),d=i),f.attachEvent=d},fireEvent:function(a,b){var c,d=this,e=function(a,b){var c=this;b=b||{bubbles:!0,cancelable:!0},b.ieHack=c.all&&c.all.toString(),b.ieHack=c.style;var d=document.createEvent("Event");d.initEvent(a,b.bubbles,b.cancelable),b.state&&(d.state=b.state),c.dispatchEvent(d)},f=function(a,b){var c=this;b=b||{bubbles:!0,cancelable:!0},b.ieHack=c.all&&c.all.toString(),b.ieHack=c.style,a="on"+a;var d=document.createEventObject();d.cancelBubble=b.cancelable,c.fireEvent(a,d)};return document.createEvent&&d.dispatchEvent?(e.call(d,a,b),c=e):document.createEventObject&&d.fireEvent&&(f.call(d,a,b),c=f),c},removeEvent:function(a,b){var c,d=this,e=function(a,b){this.removeEventListener(a,b,!1)},g=function(a,b){this.detachEvent("on"+a,b)};return d.removeEventListener?(e.call(d,a,b),c=e):d.detachEvent&&(g.call(d,a,b),c=g),f.removeEvent=c}},g={attachEvent:function(a,b){var c=this;e.add(c,a,b),f.attachEvent.call(c,a,b)},fireEvent:function(a,b){var c=this;g.fireEVent=f.fireEvent.call(c,a,b)},removeEvent:function(a,c){var d=this;if(a&&c)f.removeEvent.call(d,a,c);else if(a&&!c){var h=e.remove(d,a);h&&b.each(h,function(){var b=this;g.removeEvent.call(d,a,b)})}else if(!a&&!c){var i=e.remove(d);i&&b.each(i,function(){var a=this;a&&b.each(i[a],function(){var b=this;g.removeEvent.call(d,a,b)})})}},isHTMLElement:function(a){var b=a==document||a==window,c=function(a){return a&&a.nodeName&&a.nodeType};return b||c(a)},isEventSupported:function(a,c){if(!g.isHTMLElement(a)||!b.isType(c,"String"))return!1;var d=!1;if(a===window||a===document){d="on"+c in a;var e=!!window.ActiveXObject,f=e&&!!document.documentMode;if(!d&&f)return!1;if(d)return!0;var h=document.createElement("iframe");h.style.display="none",document.body.appendChild(h);var i=a===window?h.contentWindow:h.contentDocument;g.attachEvent.call(i,c,function(){d=!0}),g.fireEvent.call(i,c),h.parentNode.removeChild(h)}else{var j=a.tagName,c="on"+c;a=document.createElement(j),d=c in a,d||(a.setAttribute(c,"return;"),d="function"==typeof a[c]),a=null}return d}};b.DOMEvent=g}(beacon),function(a){var b=a.base,c={on:function(){var b=a.base,c=b.isType,d=b.Event.hostProxy,e=b.Event.publicDispatchEvent,f=b.Event.attachEvent;return function(a,b){var g=[].slice.call(arguments,0);b&&c(b,"Function")?f.apply(d,g):e.apply(d,g)}}(),once:function(a,b){var d=function(e,f){c.off(a,d),b.call({},e,f)};c.on(a,d)},off:function(){var b=a.base,c=b.Event.hostProxy;return function(){var a=[].slice.call(arguments,0);b.Event.removeEvent.apply(c,a)}}(),blend:b.blend,NS:b.NS,arrayIndexOf:b.ArrayIndexOf,isType:b.isType,Enum:b.Enum,loginGlobal:b.login,logoffGlobal:b.logoff,utility:b,createEvent:function(){var a=[].slice.call(arguments,0);return arguments.length>1?b.combinationalEvent.apply(this,a):{desc:a[0]}}},d={on:function(b,c){var d=[].slice.call(arguments,0),e=this.target,f=a.base,g=f.DOMEvent.isHTMLElement(e),h=f.DOMEvent.isEventSupported(e,b),i=g&&h?f.DOMEvent.fireEvent:f.Event.fireEvent,j=g&&h?f.DOMEvent.attachEvent:f.Event.attachEvent;c&&f.isType(c,"Function")?f.each(e,function(a,b){j.apply(b,d)}):f.each(e,function(a,b){i.apply(b,d)})},once:function(a,b){var c=this,e=function(f,g){d.off.call(c,a,e),b.call(c,f,g)};d.on.call(c,a,e)},off:function(a,c,d){var e=this.target,f=b.DOMEvent.isHTMLElement(e),g=a&&b.DOMEvent.isEventSupported(e,a);f&&g?b.DOMEvent.removeEvent:b.Event.removeEvent,b.each(e,function(e,g){var h=a&&b.DOMEvent.isEventSupported(g,a);f&&b.DOMEvent.removeEvent.call(g,a,c,d),h||b.Event.removeEvent.call(g,a,c,d)})}};b.blend(b.avatarCore,d),b.blend(a,c),b.init()}(beacon),function(a){function b(a){this.target=a}var c=function(a){return new b(a)};c.toString=function(){return"baishuiz@gmail.com"};var d=document.getElementsByTagName("script"),e=d[d.length-1],f={avatarCore:b.prototype,plugins:{},attach:function(a,b){f.plugins[a]=b},baseURL:e.src.replace(/\/[^\/]+$/,"/"),URLMap:{},CDNTimestamp:e.getAttribute("data-CDNTimestamp")||"",isDebug:!1,init:function(b){a.Air=f.plugins.merge(c,b)}},g={base:f};a.Air=g}(this),function(a){var b={NS:function(a,b){for(var c=a.split("."),d=b||window||{},b=d,e=0,f=c.length;f>e;e++)d[c[e]]=void 0===d[c[e]]?{}:d[c[e]],d=d[c[e]];return d},beacon:beacon,merge:beacon.utility.merge,setBaseURL:function(b){return beacon.isType(b,"Object")?(a.base.URLMap=b,a.base.baseURL=b.base||a.base.baseURL):a.base.baseURL=b||a.base.baseURL}};b.merge(a.base.plugins,b)}(Air),function(a){function b(){try{document.documentElement.doScroll("left")}catch(a){return void setTimeout(b,1)}g()}function c(a){return 1==d?void a():void e.push(a)}var d=!1,e=[],f=a.base.plugins.beacon,g=(a.base.plugins,function(){f(document).off("readystatechange",h),f(document).off("DOMContentLoaded",g),f(window).off("load",g);for(var a;a=e.shift();)d||a();d=!0}),h=function(){(/loaded|complete/.test(document.readyState)||1==d)&&g()};f(document).on("readystatechange",h),f(document).on("DOMContentLoaded",g),f(window).on("load",g),document.documentElement.doScroll&&b(),a.base.attach("DOMReady",c)}(Air),function(a,b){function c(a,b){var c=1;this.loadJS=function(){if(/\bArray\b/.test(Object.prototype.toString.call(a))){c=a.length;for(var d=c-1;d>=0;d--)e(a[d],function(){--c||b()})}else e(a,b)}}function d(){function a(){b.currentJs||(b.currentJs=b.shift(),b.currentJs&&b.currentJs.loadJS())}var b=[];b.currentJs=null,this.loadJS=function(d,e){var f=function(){b.currentJs=null,e&&e(),a()};return b.push(new c(d,f)),a(),this}}function e(a,c){var d,e=document.getElementsByTagName("head")[0],f=document.createElement("script"),g=!1,h=b.base.plugins.beacon,i=function(){g=!0,h(f).off("load"),h(f).off("readystatechange"),i=function(){},c&&c()},j=function(){/loaded|complete/.test(f.readyState)&&0==g&&i()};f.async=!0,f.setAttribute("type","text/javascript"),f.src=a,h(f).on("load",i),h(f).on("readystatechange",j),h(f).on("error",i);for(var k=document.getElementsByTagName("script"),l=0,m=k.length;!d&&m>l;l++)d=a==k[l].getAttribute("src");d||e.appendChild(f)}function f(a,b){var c=new d;return c.loadJS(a,b),c}b.base.attach(a,f)}("loadJS",Air),function(a){function b(b,d){"use strict";function e(){var e=h.toLowerCase(),f=g.toLowerCase(),i=a.base,j=i.plugins.beacon,k=i.plugins.NS,l=i.plugins.NS(g.toLowerCase(),i)[e],m=d(i.Require,i.run);l?"function"==typeof m?k(f,i)[e]=i.plugins.merge(m,l):i.plugins.merge(l,m):k(f,i)[e]=m,c[b.toLowerCase()]=!0,j.on(a.base.Require.Event.LOADED,{moduleName:b})}a.base.plugins.beacon.on(a.base.Require.Event.REQUIREING,{moduleName:b});var f=b.match(/(^.*)\.(\w*)$/),g=f[1],h=f[2],i=d.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,"");i=i.replace(/(['"\/])[\w\W]*?\1|((['"\/])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(a,b){return b?a:""});var j=i.replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(a,b){return b}).replace(i,""),k=j&&new RegExp("\\b"+j+"\\s*\\(([^\\)]+)\\)","gm"),l=[];k&&i.replace(k,function(b,d){var e,f,g=/['" ]/g,h=d.split(",");h.length>1?(e=h[0].replace(g,""),f=h[1].replace(g,"")):e=d.replace(g,"");var i=e.toLowerCase();c[i]||(l[i]=l.push(i)-1),a.base.Require(e,f)});var m=new String(b);l.length&&beacon(m).on(a.base.Require.Event.LOADED,function(b,c){var d=c.moduleName.toLowerCase();l.hasOwnProperty(d)&&(delete l[d],l.splice(l[d],1)),l.length<=0&&(beacon(m).off(a.base.Require.Event.LOADED),e())}),l.length||e()}var c={};a.base.Module=b}(Air),function(a){function b(a){if(a)return g.moduleLoaded[a];for(var b=0,c=g.requireQueue.length;c>b;b++){var d=g.requireQueue[b];if(!g.moduleLoaded[d])return!1}return!0}function c(){d.on(f.COMPLETE),d(document).on("readystatechange"),c=function(){d.on(f.COMPLETE)}}var d=a.base.plugins.beacon,e=d.createEvent,f={COMPLETE:e("require_complete"),LOADED:e("require_loaded"),REQUIREING:e("require_requireing")},g={requiring:{},required:{},moduleLoaded:{},requireQueue:[]};d(g).on(f.REQUIREING,function(a,b){var c=b.moduleName.toLowerCase();g.requireQueue[c]||g.requireQueue.push(c),g.required[c]=!0});var h=function(d,e){function f(b){var c=b.match(/(^.*)(\.\w*)$/),d=(c[1],c[2],a.base.CDNTimestamp||"");return d=d&&"?"+d,a.base.baseURL+b.replace(/\./gi,"/")+".js"+d}function h(d){i(d)||(g.requiring[d]=!0,a.base.plugins.loadJS(e,function(){if(!g.required[d])throw new Error("module ["+d+"] is undefined! @"+e);b()&&c()}))}function i(a){return g.required[a]||g.requiring[a]||g.moduleLoaded[a]}var j=d;if(d=d.toLowerCase(),g.required[d]||g.requiring[d]||g.moduleLoaded[d])return a.base.plugins.NS(d,a.base);if(e){var k=a.base.URLMap||{};e=e.replace(/{{(.+)}}/g,function(b,c){return k[c]||a.base.baseURL})}return e=e||f(j),d=d.toLowerCase(),g.requireQueue[d]=!0,g.requireQueue.push(d),h(d),a.base.plugins.NS(d,a.base)};d.on(f.LOADED,function(a,d){var e=d.moduleName.toLowerCase();g.required[e]=!0,g.moduleLoaded[e]=!0,b()&&c()}),h.Event=f,h.isRequireComplete=b,a.base.Require=h}(Air),function(a){function b(){for(;function(){var a=c.shift();return a&&a(),c.length}(););}var c=[],d=a.base.plugins.beacon,e=a.base.Require.Event;d.on(e.COMPLETE,b);var f=function(){function f(){for(var b=0;b<h.length;b++){var c=h[b];if(!h[c]&&!a.base.Require.isRequireComplete(c))return!1}return!0}var g,h=[];this.runNow&&d.on(e.LOADED,function(a,b){var c=b.moduleName.toLowerCase();h[c]=!0,beacon.utility.arrayIndexOf(h,c)>=0&&f()&&g&&g()}),this.run=function(d){g=d,this.runNow?f()&&d():(c.push(d),a.base.Require.isRequireComplete()&&b())},this.require=function(b,c){if(a.base.Require(b,c),b=b.toLowerCase(),h.push(b),!c){var d=b.match(/(^.*)\.(\w*)$/),e=d[1],f=d[2];a.base.plugins.NS(e,a.base)[f]}return a.base.plugins.NS(b,a.base)}},g=function(a,b){"use strict";var c=g;if(!(this instanceof c))return new c(a,b,arguments);var d=[].slice.call(arguments[2]).slice(2),e=this;e.runNow=b,f.call(e);var h=a.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,"");h=h.replace(/(['"\/])[\w\W]*?\1|((['"\/])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(a,b){return b?a:""});var i=h.replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(a,b){return b}).replace(h,""),j=i&&new RegExp("\\b"+i+"\\s*\\(([^\\)]+)\\)","gm");j&&h.replace(j,function(a,b){var c,d,f=/['" ]/g,g=b.split(",");g.length>1?(c=g[0].replace(f,""),d=g[1].replace(f,"")):c=b.replace(f,""),e.require(c,d)}),e.run(function(){var b=[e.require].concat(d);a.apply(this,b)})};a.base.attach("run",g)}(Air),function(a){var b=a.base.plugins,c={run:b.run,iRun:function(a){b.run(a,!0)},loadJS:b.loadJS,Module:a.base.Module,merge:a.base.merge,NS:b.NS,Enum:a.base.Enum,domReady:b.DOMReady,moduleURL:b.setBaseURL,setCDNTimestamp:a.base.setCDNTimestamp};a.base.init(c)}(Air),Air.Module("B.util.middleware",function(){function a(a,b){a&&b&&(d[a]=d[a]||[],d[a].push(b))}function b(a,b){if(a&&b){var c=d[a]||[],e=c.indexOf(b);-1!==e&&c.splice(e,1)}}function c(a,b,c){var e=d[a],f=e&&e.length;if(c=c||function(){},f){var g=0,h=function(){var a=e[g];if(g<f&&a)return void a(b,function(){g++,h.apply(h,arguments)});c.apply(c,arguments)};h()}else c()}var d={};return{add:a,run:c,remove:b}}),Air.Module("B.util.node",function(){var a=function(a){return{hasAttribute:function(b){return a.attributes.getNamedItem(b)}}};return a.type={TEXT:3,HTML:1,ATTR:2},a}),Air.Module("B.util.util",function(){var a={isEmpty:function(a){if(null==a)return!0;var b=beacon.utility.isType(a,"Object"),c=beacon.utility.isType(a,"Array");if(!b&&!c)return!1;for(var d in a)if(a.hasOwnProperty(d))return!1;return!0},enums:function(a){for(var b={},c=a.length-1;c>=0;c--)b[a[c]]=a[c];return b},getData:function(b,c){for(var d=c.parent,e=b.split("."),f=c||window||{},c=f,g=0,h=e.length;g<h;g++){if(!f||void 0===f[e[g]])return d&&a.getData(b,d);f=f[e[g]]}return f}};return a}),Air.Module("B.data.memCache",function(){function a(a,b,e){if(a&&(c[a]=b,e&&"number"==typeof e.expiredSecond)){var f=new Date;f.setSeconds(f.getSeconds()+e.expiredSecond),d[a]=f}}function b(a){if(a){var b=c[a],e=d[a];if(e){if((new Date).getTime()>e.getTime())return delete c[a],void delete d[a]}return b}}var c={},d={};return{get:b,set:a}}),Air.Module("B.data.storage",function(require){var a=require("B.data.memCache"),b=a.set;return{get:function(b,c){var d=a.get(b);c&&c(d)},set:b}}),Air.Module("B.event.events",function(){return{DATA_CHANGE:beacon.createEvent("data change"),RUN_COMPLETE:beacon.createEvent("run complete"),URL_CHANGE:beacon.createEvent("url change"),USER_ACTION:beacon.createEvent("user action"),PAGE_SHOW:beacon.createEvent("page show"),PAGE_HIDE:beacon.createEvent("page hide"),PAGE404:beacon.createEvent("")}}),Air.Module("B.directive.event",function(require){var node=require("B.util.node"),EVENTS=require("B.event.events");window.statsEvents||(window.statsEvents={}),statsEvents.USER_ACTION=EVENTS.USER_ACTION;var attribute="b-event",reg=/\((.*)\)/,api=function(target,$scope){function getParentScope(a){return a}function bind(cmd,eventIndex){var eventName=cmd.match(/^\s*(\w+)\s+/)[1];beacon(target).on(eventName,function(e){var cmd=target.getAttribute(attribute),cmdList=cmd.split(";"),handleStr=cmdList[eventIndex].replace(eventName,""),eventHandleName=handleStr.replace(reg,"").replace(/\s/g,""),eventParam=handleStr.match(reg)[1],params=eval("["+eventParam+"]");params.unshift(e),this.$index=$scope.$index;var scope=getParentScope($scope),eventHandle=$scope.$event&&$scope.$event[eventHandleName]||scope.$event&&scope.$event[eventHandleName];eventHandle&&eventHandle.apply(this,params),beacon(scope).on(EVENTS.DATA_CHANGE,scope);var viewName=getViewName(target);beacon.on(statsEvents.USER_ACTION,[location.href,eventHandleName,viewName])})}function getViewName(a){return a.parentElement?"VIEW"===a.parentElement.nodeName?a.parentElement.getAttribute("name"):getViewName(a.parentElement):""}if(node(target).hasAttribute(attribute))for(var cmd=target.getAttribute(attribute),cmdList=cmd.split(";"),i=0;i<cmdList.length;i++)bind(cmdList[i],i)};return api}),Air.Module("B.directive.show",function(require){function a(a,b,c){function d(b){b?g(a,!0):g(a)}var e=(b.scope,b.name),f=a.getAttributeNode(i);f.nodeValue="{{("+f.nodeValue+")}}",c(f.nodeValue,f,e,d,!0)}function b(a,b,c){return a.bData=a.bData||{},a.bData[b]}function c(a,b,c){return a.bData=a.bData||{},a.bData[b]=c,c}function d(a,b){var c=a.style.display;return c||(c=window.getComputedStyle?window.getComputedStyle(a,null)[b]:a.currentStyle[b]),c}function e(a){var b=document.body.appendChild(document.createElement(a)),c=d(b,"display");return document.body.removeChild(b),c}function f(a){var b=k[a];return b||(b=e(a),k[a]=b),b}function g(a,d){var e,g;a&&a.style&&(g=b(a,"olddisplay"),e=a.style.display,d?(g||"none"!==e||(a.style.display="",e=""),""===e&&(g=c(a,"olddisplay",f(a.nodeName)))):e&&"none"!==e&&c(a,"olddisplay",e),d&&"none"!==e&&""!==e||(a.style.display=d?g||"":"none"))}var h=require("B.util.node"),i=(require("B.event.events"),require("B.util.util"),"b-show"),j=function(b,c,d){h(b).hasAttribute(i)&&a(b,c,d)};j.key=i;var k={};return j}),Air.Module("B.directive.style",function(require){function a(a,b,d){function e(b){a.style.cssText=b}for(var f=(b.scope,b.index),g=a.getAttributeNode(c),h=g.nodeValue.match(/{{.*?}}/g)||[],i=0;i<h.length;i++){d(h[i],g,f,e)}}var b=require("B.util.node"),c=(require("B.event.events"),require("B.util.util"),"b-style"),d=function(d,e,f){b(d).hasAttribute(c)&&a(d,e,f)};return d}),Air.Module("B.directive.property",function(require){function a(a,c,f){for(var g=c.scope,h=c.name,i=a.getAttributeNode(e),j=a.getAttribute(e),k=b(j),l=0;l<k.length;l++){var m=k[l];!function(b,c){var e=d.getData(b,g);void 0!==e&&(a[c]=e),f("{{"+b+"}}",i,h,function(){var e=d.getData(b,g);a[c]=e})}(m.dataPath,m.name)}}function b(a){var b=/(\w+)\s*:\s*([^,}\s]+)/g,c=[];return a.replace(b,function(a,b,d){var e={name:b,dataPath:d};c.push(e)}),c}var c=require("B.util.node"),d=(require("B.event.events"),require("B.util.util")),e="b-property";return function(b,d,f){c(b).hasAttribute(e)&&a(b,d,f)}}),Air.Module("B.directive.model",function(require){function a(a,b,c,d){d=d||document;for(var e=d.querySelectorAll(c),f=0;f<e.length;f++){var g=e[f];beacon.utility.arrayIndexOf(a,g.value)>=0?g.checked=!0:g.checked=!1}}function c(a,b,c){var d=a.split("."),f=d.pop(),g=d.join(".");return g?e.getData(g,c)[f]=b:c[f]=b,{prefixPath:g,lastNode:f}}var d=require("B.util.node"),e=require("B.util.util"),f=(require("B.event.events"),"b-model"),g=function(g,h,i){function j(a){var d,f=this;if("checkbox"===f.type){var g=f.getAttribute("b-model");if(d=e.getData(g,l),beacon.utility.isType(d,"Array")){var h=beacon.utility.arrayIndexOf(d,f.value);f.checked?d.push(f.value):h>=0&&d.splice(h,1);f.nodeName.toLowerCase(),f.getAttribute("name"),b.views.getActive().getDom()}else d=f.checked}else d=f.value;var i=(c(o,d,l),"input"===a.type?"change":"input");beacon(f).off(i,j)}function k(){var c=e.getData(o,l);if(g.value===c&&"radio"!==g.type)return void(g.initValue=c);var d=e.isEmpty(c)?"":c;if(beacon.utility.isType(c,"Array")){var f=g.nodeName.toLowerCase()+"[name="+g.getAttribute("name")+"]",h=b.views.getActive().getDom();a(d,g,f,h)}else g.value===c&&"radio"!=g.type||(g.initValue=d,"file"!==g.type&&("radio"==g.type?g.checked=g.value==d:(g.checked=d,g.value=d)))}var l=h.scope,m=h.name;if(d(g).hasAttribute(f)){var n=g.getAttributeNode(f),o=g.getAttribute(f).replace(/{{|}}/gi,"");void 0!==e.getData(o,l)&&k(),beacon(g).on("input",j),beacon(g).on("change",j),i("{{"+o+"}}",n,m,k)}};return g.key=f,g}),Air.Module("B.scope.Scope",function(require){var a=(require("B.event.events"),require("B.util.util"),function(a){this.parent=a});return function(b){return a.prototype=b||{},a.prototype.constructor=a,new a(b)}}),Air.Module("B.scope.ScopeTreeManager",function(require){function a(a){var c=[],d={},e=function(){return{scope:null,pn:null,name:null}},f=function(a){return c[a]||null},g=function(a){var b=c[0]||e();b.scope=b.scope||{},beacon.utility.merge(b.scope,a),c[0]=b},h=function(a,g){var h=f(a),i=e();c[g]=i;var j=c.push(i)-1;return i.scope=new b(h.scope),i.pn=a,i.name=g,i.index=j,d[g]=i,j},i=function(a){return d[a]},j=function(a){return(d[a]||{}).scope};return g(a),{addScope:h,getScope:f,getScopeByName:i,getScopeInstanceByName:j,setRootScope:g}}var b=require("B.scope.Scope");return a}),Air.Module("B.directive.Repeater",function(require){function a(a,b,c,d){var e=new RegExp("\\b("+d+")\\b","g"),f=new RegExp("\\b"+c+"\\.\\d+\\.\\$index\\b","g"),g=new RegExp("{{\\b"+c+"\\.\\d+\\.\\$index\\b}}","g"),h=a.replace(/\{\{.*?\}\}|b-show\s*=\s*"[^"]*?"|b-model\s*=\s*"[^"]*?"|b-property\s*=\s*"[^"]*"|b-repeat\s*=\s*"[^"]*"/g,function(a){return a.replace(e,c+"."+b)});return h=h.replace(g,b),h=h.replace(f,b)}function b(a,b){"option"==b.nodeName.toLowerCase()&&setTimeout(function(){a.parentNode.value=a.parentNode.initValue},0)}function c(c,f,g,h){function i(a){if(a.placeholder)return a.placeholder;var b=document.createComment("repeat placeholder "+a.getAttribute(d));return a.parentNode.insertBefore(b,a),a.placeholder=b,b}function j(a,b){for(var c="",d=b.split(".")||[],f=0;f<d.length;f++){var g=d[f],h=c?e.getData(c,m):m;h=h||Air.NS(c,m);var i=g&&e.getData(g,h),j=Object.getOwnPropertyDescriptor(h,g);j&&D.push(j);var k=l.call(h,a,i);Object.defineProperty(h,g,k),c=g&&c?c+"."+g:g}}function k(a,b,c){a.unshift=function(a){var d=b.slice(0),e=[].concat(a,d);return c.set([]),c.set([].concat(e)),e}}function l(a,b){var c=0;b=b||[];var d={enumerable:!0,configurable:!0,get:function(){return setTimeout(function(){var d=b&&b.length||0;if(c!==d){for(var e=a.updateUI(),g=0;g<e.length;g++){var i=e[g];i&&h(i,f,f)}for(var g=0;g<D.length;g++)D[g]&&D[g].get&&D[g].get()}c=d},0),b},set:function(e,g){var i=b!==e;e||(e=beacon.utility.isType(b,"Array")?[]:{});var j=beacon.utility.isType(e,"Array"),l=beacon.utility.isType(e,"Object");if(i){if(l){b=b||{};for(var m in b)e[m]||(e[m]=void 0);g||beacon.utility.merge(b,e)}else if(j){if(b=b||[],k(e,b,d),!g){var n=b.length,o=e.length;o<n&&(b.splice(o-n,n-o),c=o);for(var m in b){var p=parseInt(m,10),q=beacon.utility.isType(p,"Number")&&!isNaN(p);q||e[m]||(e[m]=void 0)}beacon.utility.merge(b,e)}for(var r=a.updateUI(),s=0;s<r.length;s++){var t=r[s];t&&h(t,f,f)}}for(var s=0;s<D.length;s++)D[s]&&D[s].set&&D[s].set(e,!0)}}};return d}var m=g.scope,n=0,o=i(c),p=c.getAttribute("b-repeat"),q=/(\S+)\s+in\s+(\S+)/,r=p.match(q)||[],s=r[2],t=r[1],u=c.outerHTML,v=c.parentNode,w=v.tagName.toLowerCase();v.removeChild(c);var x=function(){return(e.getData(s,m)||[]).length||0},y=function(){return t},z=function(c){for(var d="",e=document.createDocumentFragment(),f=[],g=0;g<c;g++){var h=n+g;d=a(u,h,s,t);var i=document.createElement(w);i.innerHTML=d;var j=i.firstChild;j.removeAttribute("b-repeat"),j.$index=h,e.appendChild(j),f.push(j)}var k,l="select"===w,m=o.parentNode;return l&&(k=m.initValue),m.insertBefore(e,o),l&&setTimeout(function(){m.value=k},0),b(o,j),e=null,i=null,n+=c,f},A=function(a){for(var b=a.previousSibling;b&&1!==b.nodeType;)b=b.previousSibling;return b},B=function(a){a=Math.abs(a);for(var b=0;b<a;b++){var c=A(o);c&&o.parentNode.removeChild(c)}n-=a},C=function(){var a=x(),b=a-n,c=b<0,d=b>0;return c&&B(b),d&&z(b)},D=[],E={updateUI:C,getDataPrefix:y};return j(E,s),E}var d="b-repeat",e=require("B.util.util");return c}),Air.Module("B.scope.tagManager",function(require){function addNode(a,b,c,d){nodeMap[a]=nodeMap[a]||{},nodeMap[a][b]=nodeMap[a][b]||[],nodeMap[a][b].push({element:c,template:c.$template,callback:d})}function getNodes(a,b){var c=nodeMap[a];return c&&c[b]||[]}function updateNodeValue(scopeIndex,scope,token,callback){for(var nodes=getNodes(scopeIndex,token),i=0;i<nodes.length;i++){var activeNode=nodes[i],newValue=activeNode.element.$template.replace(/{{(.*?)}}/g,function(tag,expression){return eval(expression)||""}),ownerElement=activeNode.element.ownerElement;ownerElement&&"option"===ownerElement.nodeName.toLowerCase()&&ownerElement.parentNode&&setTimeout(function(){ownerElement.parentNode&&(ownerElement.parentNode.value=ownerElement.parentNode.initValue)},0),activeNode.element.nodeValue=newValue,activeNode.callback&&activeNode.callback(newValue)}}var util=require("B.util.util"),nodeMap=[],api={addNode:addNode,getNodes:getNodes,updateNodeValue:updateNodeValue};return api}),Air.Module("B.scope.scopeManager",function(require){function parseScope(a,b,c){var d=scopeTreeManager.getScopeByName(a);return d||(parseTemplate(b,a,null,null,c),d=scopeTreeManager.getScopeByName(a)||{}),d.scope}function isHTML(a){return!!a&&a.nodeType===nodeUtil.type.HTML}function isView(a){return isHTML(a)&&"VIEW"==a.nodeName.toUpperCase()}function isRepeat(a){return isHTML(a)&&a.hasAttribute("b-repeat")}function getDataPath(a){return a.match(/{{.+?}}/g)||[]}function bindObjectData(a,b,c){for(var d=scopeTreeManager.getScope(b),e=d.scope,f="",g=a.split(".")||[],h=0;h<g.length;h++){var i=g[h],j=f?util.getData(f,e):e;j=j||Air.NS(f,e);var k=i&&util.getData(i,j);i&&(!Object.getOwnPropertyDescriptor(j,i)||/^\d+$/.test(i)||h===g.length-1)&&Object.defineProperty(j,i,createDescriptor.call(j,k,a,b,c)),f=i&&f?f+"."+i:i}}function watchData(a,b,c,d,e){for(var f=scopeTreeManager.getScope(c),g=getTokens(a,b,c),h=0;h<g.length;h++){var i=g[h];d&&e&&d(util.getData(i,f.scope)),tagManager.addNode(c,i,b,d),bindObjectData(i,c,d)}}function getTokens(a,b,c){b.$template=b.$template||b.nodeValue;for(var d=(scopeTreeManager.getScope(c),a.match(/(['"])\s*([$a-zA-Z\._0-9\s\-]+)\s*\1|(['"])?\s*([$a-zA-Z\._0-9\s]+)\s*\1?/g)||[]),e=[],f=0;f<d.length;f++){var g=trim(d[f]);if(!/^\d+$/.test(g)&&!/^['"]/.test(g)&&""!=g&&"true"!==g&&"false"!==g){var h=new RegExp("(^|\\b).*?("+g.replace(/([.*?+\-^\/$])/g,"\\$1")+")","g"),i=b.$tag||a,j=i.replace(h,function(a,b,c){return a.indexOf('util.getData("'+g)>=0?a:a.replace(c,'util.getData("'+g+'", scope)')});b.$template=b.$template.replace(i,j),b.$tag=j,e.push(g)}}return e}function parseTEXT(node,currentScopeIndex){for(var tags=node.nodeValue.match(/{{.*?}}/g)||[],scope=scopeTreeManager.getScope(currentScopeIndex).scope,i=0;i<tags.length;i++){var activeTag=tags[i];if(watchData(activeTag,node,currentScopeIndex),node.$tag){var val=eval(node.$tag.replace(/(^{{)|(}}$)/g,""))||"";node.nodeValue=node.nodeValue.replace(activeTag,val),node.$tag=""}}}function tryGenerateSubViewScope(a,c){if("view"===a.tagName.toLowerCase()){var d=a.getAttribute("b-scope-key"),e=a.getAttribute("name"),f=d||e,g=c.scope,h=c.index;if(!g){var i=scopeTreeManager.addScope(h,f);g=scopeTreeManager.getScope(i)}if(d){var j=memCache.get("controllerMap")||{},k=j[e];k&&setTimeout(function(){b.run(e,k)},0)}}return c}function parseHTML(a,b){var c=scopeTreeManager.getScope(b);tryGenerateSubViewScope(a,c);var d=c.scope;initModel(a,c,watchData),eventDirective(a,d),showDirective(a,c,watchData),styleDirective(a,c,watchData),propertyDirective(a,c,watchData);for(var e=[].concat.apply([],a.attributes),f=0;f<e.length;f++){var g=e[f];-1===[initModel.key,showDirective.key].indexOf(g.name)&&parseTEXT(g,b)}}function parseTemplateRAW(a,b,c,d,e){if(a){d||(backtrackingPoints=[]),c=c||0;var f=function(a,b){if(!a&&d){var e=backtrackingPoints.pop();a=e&&e.nextSibling;var f=isView(e)?scopeTreeManager.getScope(c).pn:c;b=isView(e)&&f}return parseTemplate(a,b,f||c,!0)};if(isView(a)||e)b=a.getAttribute("b-scope-key")||a.getAttribute("name"),c=scopeTreeManager.addScope(c,b);else if(isRepeat(a)){var g=d&&a.nextSibling,h=createRepeatNodes(a,c);if(!h)return f(g,b);a=h}switch(d&&a.nextSibling&&a.firstChild&&backtrackingPoints.push(a),a.nodeType){case nodeUtil.type.HTML:parseHTML(a,c);break;case nodeUtil.type.TEXT:case nodeUtil.type.ATTR:parseTEXT(a,c)}var g=a.firstChild||d&&a.nextSibling;return f(g,b)}}function parseTemplateProxy(a){var b,c=!1,d=[];return function(){if(d.push(arguments),!c){for(c=!0;d.length;)b=a.apply(this,d.shift());return c=!1,b}}}function createRepeatNodes(a,b){var c=scopeTreeManager.getScope(b);return new Repeater(a,b,c,parseTemplate).updateUI()[0]}function createDescriptor(a,b,c,d){var e=scopeTreeManager.getScope(c),f=0;return{enumerable:!0,configurable:!0,get:function(){return beacon.utility.isType(a,"Array")&&setTimeout(function(){f!==a.length&&d&&d(),f=a.length},0),a},set:function(f){var g=a!==f,h=beacon.utility.isType(f,"Array"),i=beacon.utility.isType(f,"Object"),j=h||i;if(g&&j){if(a=a||(h?[]:{}),h){var k=a.length,l=f.length;l<k&&a.splice(l-k,k-l)}if(i)for(var m in a)m in f||(f[m]=void 0);beacon.utility.merge(a,f),h&&d&&d()}else a!==f&&(a=f,tagManager.updateNodeValue(c,e.scope,b))}}}var rootScope={},ScopeTreeManager=require("B.scope.ScopeTreeManager"),initModel=require("B.directive.model"),eventDirective=require("B.directive.event"),showDirective=require("B.directive.show"),styleDirective=require("B.directive.style"),propertyDirective=require("B.directive.property"),Repeater=require("B.directive.Repeater"),tagManager=require("B.scope.tagManager"),util=require("B.util.util"),nodeUtil=require("B.util.node"),memCache=require("B.data.memCache"),scopeTreeManager=new ScopeTreeManager(rootScope),trim=function(a){return a=a||"",a.trim?a.trim():a.replace(/^\s+|\s+^/,"")
},backtrackingPoints=[],parseTemplate=parseTemplateProxy(parseTemplateRAW);return{parseScope:parseScope,getScope:scopeTreeManager.getScopeByName,setRoot:scopeTreeManager.setRootScope,getScopeInstance:scopeTreeManager.getScopeInstanceByName,watchData:watchData}}),Air.Module("B.network.HTTP",function(){function a(){var a=new XMLHttpRequest,c=this;a.onreadystatechange=function(){a.readyState===b.complete&&(a.status>=200&&a.status<300||304==a.status||0==a.status&&c.requestURL.match(/^file:/)?c.successCallBack&&c.successCallBack(a):c.errorCallBack&&c.errorCallBack(a))},this.xhr=a}var b={unInit:0,opend:1,sended:2,receiving:3,complete:4};return a.prototype={request:function(a){this.requestURL=a.url,this.successCallBack=a.successCallBack,this.errorCallBack=a.errorCallBack,this.xhr.open(a.method,a.url,!0);for(var b in a.header)this.xhr.setRequestHeader(b,a.header[b]);this.xhr.send(a.data)},get:function(a,b){b=b||{},this.request({method:"GET",url:a,successCallBack:b.successCallBack,errorCallBack:b.errorCallBack})},abort:function(){this.xhr.abort()}},a}),Air.Module("B.service.Service",function(require){function a(a,g,j){a=a||{};var k=a.header||{};k["Content-Type"]="application/json;charset=utf-8";var l=this,m=new d;this.noTriggerEvent=!1;var n={SUCCESS:beacon.createEvent("service response success"),ERROR:beacon.createEvent("service response error")};this.EVENTS=n,this.on=function(a,b){beacon(l).on(a,b)},this.off=function(a,b){beacon(l).off(a,b)},this.getConfig=function(){var b=beacon.utility.merge({},a.header);return beacon.utility.merge({},a,{header:b})},this.query=function(d,o){function p(){j.onQuery&&j.onQuery(),b(A,function(){C=h[y],C?C.push({httpSuccessCallback:s,httpErrorCallback:t}):(C=h[y]=[],A.successCallBack=s,A.errorCallBack=t,m.request(A),q())})}function q(){z=setTimeout(function(){m.abort()},1e3*w)}function r(){clearTimeout(z)}function s(b,d){r(),b=b||{};var h="",k=null,p=!1;if(j.onComplete&&j.onComplete(),d||4!==b.readyState)k=b;else{h=b.responseText;try{k=JSON.parse(h)}catch(q){p=!0}}p?c({xhr:m.xhr,data:k,requestParam:A,errorCode:i.parse},function(a){if(o.errorCallBack&&o.errorCallBack(i.parse,h),beacon(l).on(n.ERROR,{error:i.parse,response:h}),beacon(g).on(e.DATA_CHANGE),!d){u(!0,b)}v()}):c({xhr:m.xhr,data:k,requestParam:A},function(c){if(c){if(o.errorCallBack&&o.errorCallBack(i.business,k),beacon(l).on(n.ERROR,{error:i.business,response:k}),!d){var c=!0;u(c,b)}}else{var j=function(){if(a.expiredSecond&&f.set(y,h,{expiredSecond:a.expiredSecond}),o.successCallBack&&o.successCallBack(k),beacon(l).on(n.SUCCESS,k),!d){u(!1,k)}};o.noCache?j():B(j)}beacon(g).on(e.DATA_CHANGE),v()})}function t(a,b){if(r(),j.onComplete&&j.onComplete(),v(),l.noTriggerEvent)return void(l.noTriggerEvent=!1);var d=a.status?i.network:i.timeout;c({errorCode:d,xhr:a,requestParam:A},function(c){if(o.errorCallBack&&o.errorCallBack(d,c),beacon(l).on(n.ERROR,{error:d,response:c}),!b){u(!0,a)}}),beacon(g).on(e.DATA_CHANGE)}function u(a,b){var c=([].slice.call(arguments,1),!0);if(C&&C.length){for(var d;d=C.shift();)d&&(a?d.httpErrorCallback&&d.httpErrorCallback.call(l,b,c):d.httpSuccessCallback&&d.httpSuccessCallback.call(l,b,c));v()}}function v(){C&&!C.length&&delete h[y]}o=o||{};var w=beacon.isType(a.timeout,"Number")?a.timeout:30,x=a.protocol+"://"+a.host+a.path,y=x+JSON.stringify(d),z=null,A={url:x,method:a.method,header:k,data:JSON.stringify(d),serviceName:a.serviceName},B=function(a){f.get(y,function(b){try{var c=JSON.parse(b);if(c){return void setTimeout(function(){o.successCallBack&&o.successCallBack(c,!0),beacon(l).on(n.SUCCESS,c),beacon(g).on(e.DATA_CHANGE)},0)}}catch(d){}a&&a()})},C=h[y];o.noCache||C?p():B(p)},this.abort=function(a){l.noTriggerEvent=a,m.abort()}}function b(a,b){g.run("beforeQuery",a,b)}function c(a,b){g.run("afterQuery",a,b)}var d=require("B.network.HTTP"),e=require("B.event.events"),f=require("B.data.storage"),g=require("B.util.middleware"),h={},i={parse:1,timeout:2,network:3,business:4};return a}),Air.Module("B.service.serviceFactory",function(require){function a(a,b){a&&(f[a]=b)}function b(a){return f[a]||{}}function c(a,c){if(!a)throw new Error("serviceName is required");var d=beacon.utility.merge({},b(c.extend),c);g[a]=d}function d(a,b){var c=g[a];if(c){c.serviceName=a;var d=new h(c,b,{onQuery:function(){j.push(d)},onComplete:function(){var a=beacon.utility.arrayIndexOf(j,d);-1!==a&&j.splice(a,1)}});return d}throw new Error(a+" not found")}function e(){for(var a,b=j.concat([]),c=0,d=b.length;c<d;c++)(a=b[c])&&a.abort(!0)}var f=[],g=[],h=require("B.service.Service"),i=require("B.util.middleware"),j=[];return{setConfig:a,set:c,get:d,addMiddleware:i.add,removeMiddleware:i.remove,abortAll:e}}),Air.Module("B.router.router",function(){function a(a){var c=b(a.rule),d={rule:a.rule,viewName:a.viewName,sign:a.sign,reg:c.reg,params:c.params};h.push(d),h[a.viewName]=d}function b(a){var b=/:[\w-]+/gi,c=[],d=a.replace(b,function(a){return c.push(a.replace(":","")),"([\\w-]+)"});return{reg:new RegExp("^"+d+"/*$","i"),params:c}}function c(a){var b=h.length,c=0;for(c;c<b;c++){var e=h[c],f=d(e,a);if(f)return f}return null}function d(a,b){var c=null,d=b.match(a.reg);if(d){c={rule:a.rule,viewName:a.viewName,params:{}};var e=d.length,f=1;for(f;f<e;f++){var g=a.params[f-1];c.params[g]=d[f]}}return c}function e(a,b,c,d){var e=a.replace(/:(\w+)/gi,function(a,c){return b[c]||""});return location.origin||(location.origin=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")),e=(d?"":location.origin)+e+c}function f(a,b){b=b||{};var c=b.params||{},d=b.query||"",f=h[a];return e(f&&f.rule||"",c,d,b.noOrigin)}function g(a){return h[a]||{}}var h=[];return{set:a,getMatchedRouter:c,getURLPathByViewName:f,get:g}}),Air.Module("B.view.View",function(require){function a(a){var b=document.createElement("div");return"undefined"==typeof DOMParser?b.innerHTML="X<div></div>"+a:b.innerHTML=a,b}function b(a,b){for(var c,d=0,e=a.length;d<e;d++)c=a[d],b.appendChild(c)}function c(a,b,c){setTimeout(function(){d(a,b)},0),c&&c()}function d(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=document.createElement("script"),f=d.src;d.parentNode&&d.parentNode.removeChild(d),f?Air.loadJS(f):(e.text=d.text,b.appendChild(e))}}function e(a,b){var c=a.getElementsByTagName(b);return c=[].concat.apply([],c)}function f(a,b,c,d,f){var g=e(d,a)||[];g=[].concat.apply([],g);for(var i=0;i<g.length;i++){var j=!0;h.parseScope(b+a,g[i],j);f&&f(g)}}function g(d,e,g){if(g=g||{},beacon.isType(e,"String")){var h=a(e);e=h.querySelector('view[name="'+d+'"]'),f("style",d,e,h,function(a){b(a,e)}),f("script",d,e,h,function(a){c(a,e,g.initCallback)})}var i={onShow:beacon.createEvent("view onShow"),onHide:beacon.createEvent("view onHide")};beacon(this).on(i.onShow,function(){beacon.on(statsEvents.PAGE_SHOW,[location.href,d])}),beacon(this).on(i.onHide,function(){beacon.on(statsEvents.PAGE_HIDE,[location.href,d])}),this.show=function(){e.setAttribute("active","true"),"undefined"==typeof DOMParser&&(e.style.borderBottom="1px solid transparent",setTimeout(function(){e.style.borderBottom="none"},0))},this.hide=function(){e.removeAttribute("active")},this.getDom=function(){return e},this.getViewName=function(){return d},this.events=i,this.parseSrc=function(){for(var a,b=e.querySelectorAll("[b-src]")||[],c=0,d=b.length;c<d;c++){a=b[c];var f=a.getAttribute("b-src");f&&a.setAttribute("src",f)}}}var h=require("B.scope.scopeManager"),i=require("B.event.events");return window.statsEvents||(window.statsEvents={}),statsEvents.PAGE_SHOW=i.PAGE_SHOW,statsEvents.PAGE_HIDE=i.PAGE_HIDE,g}),Air.Module("B.view.viewManager",function(require){function a(a){F.setRoot(a),b();var c=location.pathname,d=C.getMatchedRouter(c);d?f(d.viewName,{replace:!0,init:!0,params:d.params,query:location.search}):q(),n()}function b(){for(var a=document.querySelectorAll("viewport"),b=0,c=a.length;b<c;b++){var f=a[b],g="true"===f.getAttribute("main"),h={dom:f,views:[]};I.push(h),g&&d(h),e(h)}}function c(a,b){L.dom.appendChild(b.getDom()),L.views[a]=b}function d(a){L=a}function e(a){for(var b=a.dom,c=b.children,d=0,e=c.length;d<e;d++){var f=c[d];if("view"===f.tagName.toLowerCase()){var g=f.getAttribute("name"),h=new B(g,f);a.views[g]=h,F.parseScope(g,h.getDom())}}}function f(a,b){var c={viewName:a,options:b},d=function(){var c=r(a);g(a)||(c?(v(),l(a,b),j(a,b),p(a)):(h(a),u(a,b)))};H.run("beforeGoTo",c,d)}function g(a){return-1!==beacon.utility.arrayIndexOf(J,a)}function h(a){-1===beacon.utility.arrayIndexOf(J,a)&&J.push(a)}function i(a){var b=beacon.utility.arrayIndexOf(J,a);-1!==b&&J.splice(b,1)}function j(a,b){if(b=b||{},!b.isComponent){var c=F.getScopeInstance(a);c.$request=c.$request||{},c.$request.params=b.params}}function k(a,b){return C.getURLPathByViewName(a,{params:b.params,query:b.query})}function l(a,b){if(b=b||{},!b.isComponent){var c=k(a,b),d=b.replace;if(history.pushState&&history.replaceState){var e=d?history.replaceState:history.pushState;e&&e.call(history,{viewName:a,params:b.params},a,c)}else d?!b.init&&location.replace(c):location.href=c;m()}}function m(){H.run("afterURLChange")}function n(){beacon(window).on("popstate",function(a){var b=a.state||{};if(v(),b.viewName){if(r(b.viewName))j(b.viewName,b),p(b.viewName),m();else{var c=location.pathname,d=C.getMatchedRouter(c);d?f(d.viewName,{replace:!0,params:d.params,query:location.search}):q()}}})}function o(){window.history.back()}function p(a){var b=r(a);b?(b.parseSrc(),x(b)):q()}function q(){H.run("viewNotFound")}function r(a){return L.views[a]}function s(a){var b=K.getDom(),c=b.querySelector('view[name="'+a+'"]');return c&&c.getAttribute("b-scope-key")||""}function t(a,b){b=b||{};var c=E.get("env"),d=b.path||c.$templatePath,e=d+b.templatePath.replace(/\./g,"/")+".html",f=b.errorCallBack||function(){};if(N[a])return N[a];(new D).get(e,{successCallBack:function(c){var d=c.responseText;N[a]=d,b.onSuccess&&b.onSuccess(d)},errorCallBack:f})}function u(a,b){function d(d){var e=d.responseText,f=new B(a,e,{initCallback:function(){}}),g=F.parseScope(a,f.getDom());j(a,b),c(a,f),v(),w(f),beacon(g).once(G.RUN_COMPLETE,function(){l(a,b),p(a),i(a)})}function e(){q()}b=b||{},O.showLoading();var f=E.get("env"),g=C.get(a),h=g.sign||"",k=h?"_"+h:"",m=b.templatePath||f.$templatePath,n=m+a+k+".html";(new D).get(n,{successCallBack:d,errorCallBack:e})}function v(){M=A()}function w(a){K=a}function x(a){var b="";M&&(b=M.getViewName(),y(M,a)),w(a),K.show(),z(K,b),O.hideLoading()}function y(a,b){var c=a.getViewName();a&&a.hide(),beacon(a).on(a.events.onHide,{to:b});var d=F.getScopeInstance(c);beacon(d).on(G.DATA_CHANGE)}function z(a,b){var c=a.getViewName();beacon(a).on(a.events.onShow,{from:b});var d=F.getScopeInstance(c);beacon(d).on(G.DATA_CHANGE)}function A(){return K}var B=require("B.view.View"),C=require("B.router.router"),D=require("B.network.HTTP"),E=require("B.data.memCache"),F=require("B.scope.scopeManager"),G=require("B.event.events"),H=require("B.util.middleware"),I=[],J=[],K=null,L=null,M=null,N={},O={loadingHandle:null,showLoading:function(){O.loadingHandle&&O.loadingHandle.show()},hideLoading:function(){O.loadingHandle&&O.loadingHandle.hide()},setLoading:function(a){O.loadingHandle=a},unsetLoading:function(){O.loadingHandle=null}};return{init:a,goTo:f,back:o,addMiddleware:H.add,removeMiddleware:H.remove,loading:O,getActive:A,getScopeKeyByViewName:s,getTemplate:t}}),Air.Module("B.controller.run",function(require){var a=require("B.data.memCache");return function(b,c){var d=require("B.scope.scopeManager"),e=require("B.view.viewManager"),f=require("B.event.EVENTS"),g=e.getScopeKeyByViewName(b),h=d.getScopeInstance(g||b);if(g){var i=a.get("controllerMap");i||(i={},a.set("controllerMap",i)),i[b]=c,a.set("controllerMap",i)}Air.run(c,!1,h),Air.run(function(){beacon(h).on(f.DATA_CHANGE,h),beacon(h).on(f.RUN_COMPLETE)})}}),Air.Module("B.TDK.TDK",function(){function a(a){return document.title=a||document.title,document.title}function b(a){var b=d("description");return b.content=a||b.content,b.content}function c(a){var b=d("keywords");return b.content=a||b.content,b.content}function d(a){var b=f.querySelector("meta[name="+a+"]");return b=b||e(a)}function e(a){var b=document.createElement("meta");return b.setAttribute("name",a),f.appendChild(b),b}var f=document.head||document.getElementsByTagName("head")[0];return{setTitle:a,setDescription:b,setKeywords:c}}),Air.run(function(require){var a=require("B.view.viewManager"),b=require("B.scope.scopeManager"),c=require("B.router.router"),d=require("B.data.memCache"),e=require("B.controller.run"),f=require("B.service.serviceFactory"),g=require("B.network.HTTP"),h=require("B.TDK.TDK");!function(){var i={views:a,router:c,scopeManager:b,service:f,utility:{HTTP:g},init:function(b){b=b||{},d.set("env",b),Air.moduleURL(b.$moduleURL),a.init(b)},run:e,Module:Air.Module,TDK:h,bridge:{run:function(){},isHybrid:!1,isInApp:!1},ready:function(a){a="function"==typeof a?a:function(){},Air.domReady(function(){a()})},setModuleURL:function(a){Air.moduleURL(a)}};window.b=i}()});