!function(a){function b(a){this.target=a}var c=a.beacon,d=function(c){return this!==a&&d.blend(this,d),new b(c)};d.toString=function(){return"baishuiz@gmail.com"};var e={base:f,avatarCore:b.prototype,self:f,init:function(){var b=Object.freeze;a.beacon=d,e.merge(d,f),delete a.beacon.base,b&&b(d)},login:function(){a.beacon=d},logoff:function(){a.beacon=c}},f={base:e};a.beacon=f}(this),function(a){var b=a.base||{},c={merge:function(a){for(var b=arguments.length,c=0;b>c;c++){var d=arguments[c];for(var e in d)a[e]=d[e]}return a},blend:function(a,b,d){var e={cover:!0,mergePrototype:!1};d=d?c.merge(e,d):e,b=[].concat(b);for(var f=b.length,g=0;f>g;g++){var h=b[g];for(var i in h){var j=d.mergePrototype||h.hasOwnProperty(i),k=d.cover||!a[i];j&&k&&(a[i]=h[i])}}return a},isType:function(a,b){return"Null"===b&&null===a||"Undefined"===b&&void 0===a||"Number"===b&&isFinite(a)||Object.prototype.toString.call(a).slice(8,-1)===b},arrayIndexOf:function(a,b){return c.arrayIndexOf=Array.prototype.indexOf?function(a,b){return a=[].slice.call(a,0),a.indexOf(b)}:function(a,b){a=[].slice.call(a,0);for(var c=a.length;c>=0;c--)if(a[c]===b)return c;return c},c.arrayIndexOf(a,b)},each:function(a,b){if(a){a=[].concat(a);for(var c=0;c<a.length;c++)b.call(a[c],c,a[c])}}};c.blend(b,c)}(beacon),function(a){var b=a.base,c=function(a){function c(a){var b=e(f,a);0>b&&(b=f.push(a)-1);var c="event_"+b,d=a.toString()===a?a:c;return d}function d(a){var b=e(f,a);return 0>b?null:c(a)}var e=b.arrayIndexOf,f=[],g={dom:a,target:a,attachEvent:function(a,b){var d=c(a);f[d]=f[d]||[],f[d].push(b)},removeEvent:function(a,b){var d,g=a&&c(a),h=g&&f[g];if(a&&b){var i=e(h,b);d=f[g].splice(i,1)}else a&&!b?(d=f[g],f[g]=[]):a||b||(d=f,f=[]);return d},getEventList:function(a){var b=d(a);if(b)var c=a?f[b]:f.slice(0);return c}};return g};b.EventStructure=c}(beacon),function(a){function b(a){for(var b=0;b<h.length;b++){var c=h[b];if(c.target===a)return c}var d=new j(a);return h.push(d),d}function c(a,c,d){var e=g(a)||b(a);e.attachEvent(c,d)}function d(a,b,d){var e=b.registEvent(d),f=b.getEventList();i.each(f,function(b){c(a,f[b],e)})}function e(a,b,c){var d=h.slice(0),e=a?g(a)||[]:h.slice(0);i.each(e,function(a,e){if(e.removeEvent(b,c),!b&&!c){var a=i.arrayIndexOf(h,e);d.splice(a,1)}}),h=d}function f(a,b,c){var d=b.removeEvent(c);i.each(d,function(c){var f=d[c],g=b.getEventList();i.each(g,function(b,c){e(a,c,f)})})}function g(a){if(!a)return h.slice(0);for(var b=0;b<h.length;b++){var c=h[b];if(c.dom===a)return c}}var h=[],i=a.base,j=i.EventStructure,k={registEvent:c,registCombinationEvent:d,removeEvent:e,removeCombinationEvent:f,getEventList:g};i.eventStore=k}(beacon),function(a){function b(){if(this instanceof b)return this;var a=[],d=[],e=[].slice.call(arguments,0),f=e.slice(0),g=function(){function b(){return f=e.slice(0)}var g=function(b,e){var f=c.arrayIndexOf(a,b);0>f&&(a.push(b),d.push(e))},h=function(b){var e=c.arrayIndexOf(a,b),f=d[e];return b?f:d.slice(0)};this.resetEventList=b,this.getEventList=function(){return e.slice(0)},this.registEvent=function(a){var d=c.arrayIndexOf,f=e.slice(0),h=function(c,e){var g=this,h=d(f,c.eventType);h>=0&&f.splice(h,1),0===f.length&&(a.call(g,e),f=b())};return g(a,h),h},this.removeEvent=function(a){var b=[].concat(h(a));return b}};return g.prototype=new b,new g}var c=a.base;c.combinationalEvent=b}(beacon),function(a){var b=a.base,c=b.eventStore,d=c.registCombinationEvent,e=c.registEvent,f=c.removeCombinationEvent,g=c.removeEvent,h=c.getEventList,i={hostProxy:{},attachActionEvent:function(a,c,d){var e=a.desc,f=b.isType(a.desc,"Function");f&&e(c,d);var g=["touchmove","mousemove"];b.each(g,function(b,c){f&&window.beacon(document).on(c,function(b){i.publicDispatchEvent(a,b)})})},attachEvent:function(a,c){var f=this,g=a instanceof b.combinationalEvent?d:e;i.attachActionEvent(a,f,c),g(f,a,c)},fireEvent:function(a,c){var d=this,e=h(d);if(e){var f=e.getEventList(a),g=b.isType(a.desc,"Function"),i=g&&a.desc(c);!!i==!!g&&b.each(f,function(b,e){var f={eventType:a};e.call(d,f,c)})}},publicDispatchEvent:function(a,c){var d=h(),e=b.isType(a.desc,"Function");e&&a.desc(c),b.each(d,function(b){var e=d[b].dom;i.fireEvent.call(e,a,c)})},removeEvent:function(a,c){var d=this,e=a instanceof b.combinationalEvent?f:g;e(d,a,c)}},j=function(){var a=function(){};return a.prototype=i,b.blend(a,i),a}();b.Event=j}(beacon),function(a){var b=a.base,c=function(){return this}(),d=b.EventStructure,e={structures:[],getStructure:function(a){for(var b,c=0;c<e.structures.length;c++)if(b=e.structures[c],b.dom===a)return b},add:function(a,b,c){var f=e.getStructure(a);f||(f=new d(a),e.structures.push(f)),f.attachEvent(b,c)},remove:function(a,b,c){var d=e.getStructure(a);return d&&d.removeEvent(b,c)}},f={attachEvent:function(a,b){var d,e=this,g=function(a,b){var c=this;c.addEventListener(a,b,!1)},h=function(a,b){var c=this;c.attachEvent("on"+a,b)},i=function(a,b){var c=this,d=c["on"+a];c["on"+a]=function(){d.call(c),b.call(c)}};return c.addEventListener?(g.call(e,a,b),d=g):c.attachEvent?(h.call(e,a,b),d=h):(i.call(e,a,b),d=i),f.attachEvent=d},fireEvent:function(a,b){var c,d=this,e=function(a,b){var c=this;b=b||{bubbles:!0,cancelable:!0},b.ieHack=c.all&&c.all.toString(),b.ieHack=c.style;var d=document.createEvent("Event");d.initEvent(a,b.bubbles,b.cancelable),c.dispatchEvent(d)},f=function(a,b){var c=this;b=b||{bubbles:!0,cancelable:!0},b.ieHack=c.all&&c.all.toString(),b.ieHack=c.style,a="on"+a;var d=document.createEventObject();d.cancelBubble=b.cancelable,c.fireEvent(a,d)};return document.createEvent&&d.dispatchEvent?(e.call(d,a,b),c=e):document.createEventObject&&d.fireEvent&&(f.call(d,a,b),c=f),c},removeEvent:function(a,b){var c,d=this,e=function(a,b){var c=this;c.removeEventListener(a,b,!1)},g=function(a,b){var c=this;c.detachEvent("on"+a,b)};return d.removeEventListener?(e.call(d,a,b),c=e):d.detachEvent&&(g.call(d,a,b),c=g),f.removeEvent=c}},g={attachEvent:function(a,b){var c=this;e.add(c,a,b),f.attachEvent.call(c,a,b)},fireEvent:function(a,b){var c=this;g.fireEVent=f.fireEvent.call(c,a,b)},removeEvent:function(a,c){var d=this;if(a&&c)f.removeEvent.call(d,a,c);else if(a&&!c){var h=e.remove(d,a);h&&b.each(h,function(){var b=this;g.removeEvent.call(d,a,b)})}else if(!a&&!c){var i=e.remove(d);i&&b.each(i,function(){var a=this;a&&b.each(i[a],function(){var b=this;g.removeEvent.call(d,a,b)})})}},isHTMLElement:function(a){var b=a==document||a==window,c=function(a){var b=a&&a.nodeName;return b&&a.nodeType};return b||c(a)},isEventSupported:function(a,c){if(!g.isHTMLElement(a)||!b.isType(c,"String"))return!1;var d=!1;if(a===window||a===document){d="on"+c in a;var e=!!window.ActiveXObject,f=e&&!!document.documentMode;if(!d&&f)return!1;if(d)return!0;var h=document.createElement("iframe");h.style.display="none",document.body.appendChild(h);var i=a===window?h.contentWindow:h.contentDocument;g.attachEvent.call(i,c,function(){d=!0}),g.fireEvent.call(i,c),h.parentNode.removeChild(h)}else{var j=a.tagName,c="on"+c;a=document.createElement(j),d=c in a,d||(a.setAttribute(c,"return;"),d="function"==typeof a[c]),a=null}return d}};b.DOMEvent=g}(beacon),function(a){var b=a.base,c={on:function(){var b=a.base,c=b.isType,d=b.Event.hostProxy,e=b.Event.publicDispatchEvent,f=b.Event.attachEvent,g=function(a,b){var g=[].slice.call(arguments,0);b&&c(b,"Function")?f.apply(d,g):e.apply(d,g)};return g}(a),once:function(a,b){var d=function(){c.off(a,b)};c.on(a,b),c.on(a,d)},off:function(){var b=a.base,c=b.Event.hostProxy,d=function(){var a=[].slice.call(arguments,0);b.Event.removeEvent.apply(c,a)};return d}(),blend:b.blend,NS:b.NS,arrayIndexOf:b.ArrayIndexOf,isType:b.isType,Enum:b.Enum,loginGlobal:b.login,logoffGlobal:b.logoff,utility:b,createEvent:function(){var a,c=[].slice.call(arguments,0);return a=arguments.length>1?b.combinationalEvent.apply(this,c):{desc:c[0]}}},d={on:function(b,c){var d=[].slice.call(arguments,0),e=this.target,f=a.base,g=f.DOMEvent.isHTMLElement(e),h=f.DOMEvent.isEventSupported(e,b),i=g&&h?f.DOMEvent.fireEvent:f.Event.fireEvent,j=g&&h?f.DOMEvent.attachEvent:f.Event.attachEvent;c&&f.isType(c,"Function")?f.each(e,function(a,b){j.apply(b,d)}):f.each(e,function(a,b){i.apply(b,d)})},once:function(a,b){var c=this;d.on.call(c,a,b),d.on.call(c,a,function(){d.off.call(c,a,b)})},off:function(a,c,d){var e=this.target,f=b.DOMEvent.isHTMLElement(e),g=a&&b.DOMEvent.isEventSupported(e,a);f&&g?b.DOMEvent.removeEvent:b.Event.removeEvent,b.each(e,function(e,g){var h=a&&b.DOMEvent.isEventSupported(g,a);f&&b.DOMEvent.removeEvent.call(g,a,c,d),h||b.Event.removeEvent.call(g,a,c,d)})}};b.blend(b.avatarCore,d),b.blend(a,c),b.init()}(beacon),function(a){function b(a){this.target=a}var c=function(a){return new b(a)};c.toString=function(){return"baishuiz@gmail.com"};var d=document.getElementsByTagName("script"),e=d[d.length-1],f={avatarCore:b.prototype,plugins:{},attach:function(a,b){f.plugins[a]=b},baseURL:e.src.replace(/\/[^\/]+$/,"/"),CDNTimestamp:e.getAttribute("data-CDNTimestamp")||"",isDebug:!1,init:function(b){a.Air=f.plugins.merge(c,b)}},g={base:f};a.Air=g}(this),function(a){var b={NS:function(a,b){for(var c=a.split("."),d=b||window||{},b=d,e=0,f=c.length;f>e;e++)d[c[e]]=void 0===d[c[e]]?{}:d[c[e]],d=d[c[e]];return d},beacon:beacon,merge:beacon.utility.merge,setBaseURL:function(b){return a.base.baseURL=b||a.base.baseURL}};b.merge(a.base.plugins,b)}(Air),function(a){function b(){try{document.documentElement.doScroll("left")}catch(a){return void setTimeout(b,1)}g()}function c(a){return 1==d?void a():void e.push(a)}var d=!1,e=[],f=a.base.plugins.beacon,g=(a.base.plugins,function(){f(document).off("readystatechange",h),f(document).off("DOMContentLoaded",g),f(window).off("load",g);for(var a;a=e.shift();)d||a();d=!0}),h=function(){(/loaded|complete/.test(document.readyState)||1==d)&&g()};f(document).on("readystatechange",h),f(document).on("DOMContentLoaded",g),f(window).on("load",g),document.documentElement.doScroll&&b(),a.base.attach("DOMReady",c)}(Air),function(a,b){function c(a,b){var c=1;this.loadJS=function(){if(/\bArray\b/.test(Object.prototype.toString.call(a))){c=a.length;for(var d=c-1;d>=0;d--)e(a[d],function(){--c||b()})}else e(a,b)}}function d(){function a(){b.currentJs||(b.currentJs=b.shift(),b.currentJs&&b.currentJs.loadJS())}var b=[];b.currentJs=null,this.loadJS=function(d,e){var f=function(){b.currentJs=null,e&&e(),a()};return b.push(new c(d,f)),a(),this}}function e(a,c){var d,e=document.getElementsByTagName("head")[0],f=document.createElement("script"),g=!1,h=b.base.plugins.beacon,i=function(){g=!0,h(f).off("load"),h(f).off("readystatechange"),i=function(){},c&&c()},j=function(){/loaded|complete/.test(f.readyState)&&0==g&&i()};f.async=!0,f.setAttribute("type","text/javascript"),f.src=a,h(f).on("load",i),h(f).on("readystatechange",j),h(f).on("error",i);for(var k=document.getElementsByTagName("script"),l=0,m=k.length;!d&&m>l;l++)d=a==k[l].getAttribute("src");d||e.appendChild(f)}function f(a,b){var c=new d;return c.loadJS(a,b),c}b.base.attach(a,f)}("loadJS",Air),function(a){function b(b,d){"use strict";function e(){var e=i.toLowerCase(),f=h.toLowerCase(),g=a.base,j=g.plugins.beacon,k=g.plugins.NS,l=g.plugins.NS(h.toLowerCase(),g)[e],m=d(g.Require,g.run);l?"function"==typeof m?k(f,g)[e]=g.plugins.merge(m,l):g.plugins.merge(l,m):k(f,g)[e]=m,c[b.toLowerCase()]=!0,j.on(a.base.Require.Event.LOADED,{moduleName:b})}var f=a.base.plugins;f.beacon.on(a.base.Require.Event.REQUIREING,{moduleName:b});var g=b.match(/(^.*)\.(\w*)$/),h=g[1],i=g[2],j=d.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,"");j=j.replace(/(['"])[\w\W]*?\1|((['"])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(a,b){return b?a:""});var k=j.replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(a,b){return b}).replace(j,""),l=k&&new RegExp("\\b"+k+"\\s*\\(([^\\)]+)\\)","gm"),m=[];l&&j.replace(l,function(b,d){var e=d.replace(/['"]/g,""),f=e.toLowerCase();c[f]||(m[f]=m.push(f)-1),a.base.Require(e)});var n=new String(b);m.length&&beacon(n).on(a.base.Require.Event.LOADED,function(b,c){var d=c.moduleName.toLowerCase();m.hasOwnProperty(d)&&(delete m[d],m.splice(m[d],1)),m.length<=0&&(beacon(n).off(a.base.Require.Event.LOADED),e())}),m.length||e()}var c={};a.base.Module=b}(Air),function(a){function b(a){if(a)return g.moduleLoaded[a];for(var b=0,c=g.requireQueue.length;c>b;b++){var d=g.requireQueue[b];if(!g.moduleLoaded[d])return!1}return!0}function c(){d.on(f.COMPLETE),d(document).on("readystatechange"),c=function(){d.on(f.COMPLETE)}}var d=a.base.plugins.beacon,e=d.createEvent,f={COMPLETE:e("require_complete"),LOADED:e("require_loaded"),REQUIREING:e("require_requireing")},g={requiring:{},required:{},moduleLoaded:{},requireQueue:[]};d(g).on(f.REQUIREING,function(a,b){var c=b.moduleName.toLowerCase();g.requireQueue[c]||g.requireQueue.push(c),g.required[c]=!0});var h=function(d,e){function f(b){var c=b.match(/(^.*)(\.\w*)$/),d=(c[1],c[2],a.base.CDNTimestamp||"");return d=d&&"?"+d,a.base.baseURL+b.replace(/\./gi,"/")+".js"+d}function h(d){i(d)||(g.requiring[d]=!0,a.base.plugins.loadJS(e,function(){if(!g.required[d])throw new Error("module ["+d+"] is undefined! @"+e);b()&&c()}))}function i(a){return g.required[a]||g.requiring[a]||g.moduleLoaded[a]}var j=d;return d=d.toLowerCase(),g.required[d]||g.requiring[d]||g.moduleLoaded[d]?a.base.plugins.NS(d,a.base):(e=e||f(j),d=d.toLowerCase(),g.requireQueue[d]=!0,g.requireQueue.push(d),h(d),a.base.plugins.NS(d,a.base))};d.on(f.LOADED,function(a,d){var e=d.moduleName.toLowerCase();g.required[e]=!0,g.moduleLoaded[e]=!0,b()&&c()}),h.Event=f,h.isRequireComplete=b,a.base.Require=h}(Air),function(a){function b(){for(;function(){var a=c.shift();return a&&a(),c.length}(););}var c=[],d=a.base.plugins.beacon,e=a.base.Require.Event;d.on(e.COMPLETE,b);var f=function(){function f(){for(var b=0;b<h.length;b++){var c=h[b];if(!h[c]&&!a.base.Require.isRequireComplete(c))return!1}return!0}var g,h=[];this.runNow&&d.on(e.LOADED,function(b,c){var d=c.moduleName.toLowerCase();h[d]=!0,a.base.ArrayIndexOf(h,d)>=0&&f()&&g&&g()}),this.run=function(d){g=d,this.runNow?f()&&d():(c.push(d),a.base.Require.isRequireComplete()&&b())},this.require=function(b,c){if(a.base.Require(b,c),b=b.toLowerCase(),h.push(b),!c){var d=b.match(/(^.*)\.(\w*)$/),e=d[1],f=d[2];a.base.plugins.NS(e,a.base)[f]}var g=a.base.plugins.NS(b,a.base);return g}},g=function(a,b){"use strict";var c=g;if(!(this instanceof c))return new c(a,b,arguments);var d=[].slice.call(arguments[2]).slice(2),e=this;e.runNow=b,f.call(e);var h=a.toString().replace(/(?!['"])\/\*[\w\W]*?\*\//gim,"");h=h.replace(/(['"])[\w\W]*?\1|((['"])[\w\W]*?)\/\/[\w\W]*?\2|\/\/[\w\W]*?(\r|\n|$)/g,function(a,b){return b?a:""});var i=h.replace(/^function\s*?\(\s*?([^,\)]+)[\w\W]*$/,function(a,b){return b}).replace(h,""),j=i&&new RegExp("\\b"+i+"\\s*\\(([^\\)]+)\\)","gm");j&&h.replace(j,function(a,b){var c=b.replace(/['"]/g,"");e.require(c)}),e.run(function(){var b=[e.require].concat(d);a.apply(this,b)})};a.base.attach("run",g)}(Air),function(a){var b=a.base.plugins,c={run:b.run,iRun:function(a){b.run(a,!0)},loadJS:b.loadJS,Module:a.base.Module,merge:a.base.merge,NS:b.NS,Enum:a.base.Enum,domReady:b.DOMReady,moduleURL:b.setBaseURL,setCDNTimestamp:a.base.setCDNTimestamp};a.base.init(c)}(Air),Air.Module("core.directive",function(){var a={app:"ng-app",controller:"ng-controller"},b={signup:function(b,c){return a[b]=a[b]||c,a[b]},key:a};return b}),Air.Module("core.event",function(){var a={DATA_CHANGE:beacon.createEvent("data change"),REPEAT_DATA_CHANGE:beacon.createEvent("repeat data change"),REPEAT_DONE:beacon.createEvent("repeat done"),URL_CHANGE:beacon.createEvent("url change"),PAGE404:beacon.createEvent("")};return a}),Air.Module("core.config",function(){var a={},b={get:function(b){return a[b]},set:function(b,c){return a[b]=c,a[b]}};return b}),Air.Module("core.network.request",function(){function a(){var a=new XMLHttpRequest,d=this;a.onreadystatechange=function(){a.readyState===b.complete&&(a.status>=200&&a.status<300||304==a.status?beacon(d).on(c.REQUEST_COMPLETE,{data:a.responseText,xhr:a}):beacon(d).on(c.REQUEST_COMPLETE,{err:a.status,xhr:a}))},this.xhr=a}var b={unInit:0,opend:1,sended:2,receiving:3,complete:4},c={REQUEST_COMPLETE:beacon.createEvent("request complete")};return a.prototype={request:function(a){this.xhr.open(a.method,a.url,!0);for(var b in a.header)this.xhr.setRequestHeader(b,a.header[b]);this.xhr.send(a.data)},get:function(a,b){this.request({method:"GET",url:a,data:b})}},a.EVENTS=c,a}),Air.Module("utility.TDK",function(a){function b(a){if(a){document.title=a.title||"";var b=document.getElementsByTagName("head")[0],c=b.querySelector('meta[name="description"]'),d=b.querySelector('meta[name="keywords"]');c&&c.setAttribute("content",a.description||""),d&&d.setAttribute("content",a.keywords||"")}}return{set:b}}),Air.Module("utility.node",function(){var a=function(a){var b={hasAttribute:function(b){return a.attributes.getNamedItem(b)}};return b};return a.type={TEXT:3,HTML:1,ATTR:2},a}),Air.Module("utility.query",function(a){var b={getQuerys:function(a){for(var b,c=/[?&]([^=#]+)=([^&#]*)/g,d={};b=c.exec(a);)d[b[1]]=b[2];return d},getQueryString:function(a){var c=b.getQuerys(a),d=[];for(var e in c)d.push(e+"="+c[e]);return d.length?"?"+d.join("&"):""}};return b}),Air.Module("utility.switchStyle",function(a){var b=function(){var a="[ng-app] { text-indent: -10000%; background-color: #eee; }",b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";var d=function(){c.styleSheet?c.styleSheet.cssText=a:(c.innerText="",c.appendChild(document.createTextNode(a)))};return b.appendChild(c),{show:function(){d(),c.disabled=!1},hide:function(){c.disabled=!0,c.innerText=""}}}();return b}),Air.Module("utility.util",function(){var a={isEmpty:function(a){var b=beacon.utility.isType(a,"Object"),c=beacon.utility.isType(a,"Array");if(!b&&!c)return!1;for(var d in a)if(a.hasOwnProperty(d))return!1;return!0},enums:function(a){for(var b={},c=a.length-1;c>=0;c--)b[a[c]]=a[c];return b}};return a}),Air.Module("core.router",function(a){function b(a){var b=[],c=a.router.replace(/\//gi,"/").replace(/:\w+/gi,function(a){return b.push(a.replace(":","")),"(\\w+)"}),d=new RegExp("^"+c+"/*$","i");return a.rule=d,a.params=b,a}var c={},d=[],e={},f=a("utility.query"),g=(a("core.config"),function(a){});return g.param={},g.set=function(a){d.push(b(a)),c[a.viewName]=a.sign,e[a.viewName]=a.router},g.getParams=function(a){var b=g.match(a||location.pathname)||{};return b.params||{}},g.getQuerys=function(a){return f.getQuerys(a||location.href)},g.getQueryString=function(a){return f.getQueryString(a||location.href)},g.getRule=function(a){return e[a]},g.getSign=function(a){return c[a]||""},g.match=function(a){for(var b=0;b<d.length;b++){var c=d[b],e=a.match(c.rule);if(e){for(var f=1;f<e.length;f++){var g=c.params[f-1];c.params[g]=e[f]}return c}}},g}),Air.Module("direcitve.event",function(require){var directive=require("core.directive"),node=require("utility.node"),EVENTS=require("core.event");directive.signup("event","ng-event");var reg=/(\((.*?)\))/,api=function(target,$scope){function bind(cmd,eventIndex){var eventName=cmd.match(/^\s*(\w+)\s+/)[1];beacon(target).on(eventName,function(e){var cmd=target.getAttribute(directive.key.event),cmdList=cmd.split(";"),handleStr=cmdList[eventIndex].replace(eventName,""),eventHandle=handleStr.replace(reg,"").replace(/\s/g,""),eventParam=handleStr.match(reg)[2],params=eval("["+eventParam+"]");params.unshift(e),this.$index=$scope.$index;var scope=$scope.$parentScope||$scope;scope.$event[eventHandle].apply(this,params),beacon(scope).on(EVENTS.DATA_CHANGE,scope)})}if(node(target).hasAttribute(directive.key.event))for(var cmd=target.getAttribute(directive.key.event),cmdList=cmd.split(";"),i=0;i<cmdList.length;i++)bind(cmdList[i],i)};return api}),Air.Module("direcitve.model",function(a){var b=a("core.directive"),c=a("utility.node"),d=a("utility.util"),e=a("core.event");String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),b.signup("model","ng-model");var f=function(a,f){if(c(a).hasAttribute(b.key.model)){var g=a.getAttribute(b.key.model).replace(/{{|}}/gi,"");beacon(a).on("input",function(){var a=this;a.value=a.value.trim(),new Function("$scope","target","$scope."+g+"= target.value")(f,a),beacon(f).on(e.DATA_CHANGE,f)});(function(a){})(a);beacon(f).on(e.DATA_CHANGE,function(b,c){var e=Air.NS(g,c);a.value=d.isEmpty(e)?"":e.trim?e.trim():e})}};return f}),Air.Module("core.scope",function(){var a=function(a){},b=function(b){return a.prototype=b||{},new a(b)};return b}),Air.Module("core.scopeList",function(a){function b(a){var b=a.querySelectorAll("["+d.key.app+"]");return b}function c(a,c){a=a||document;for(var h=b(a),i=0,j=h.length;j>i;i++){var k=h[i],l=k.getAttribute(d.key.app);rootScope=new e,shadowScope=new e,f[l]=rootScope,g[l]=shadowScope}for(var i=0,j=h.length;j>i;i++){var k=h[i],l=k.getAttribute(d.key.app);c(k.childNodes,f[l])}}var d=a("core.directive"),e=a("core.scope"),f={},g={},h={init:c,get:function(a){return f[a]},set:function(a,b){var c=new e(b);return f[a]=c,c.__$shadowScope__=shadowScope,c}};return h}),Air.Module("directive.repeat",function(a){function b(a,b){var d=document.createComment("repeat placeholder ");return cloneNode=c(a,b),container=document.createDocumentFragment(),a.parentNode.insertBefore(d,a),d.parentNode.removeChild(a),d}function c(a,b){var c=a.cloneNode(!0);return d(a,b),c}function d(b,c){var d=function(){var c=this,d=(a("utility.node"),b.getAttribute(k));needRepeat=!!d,group=d.replace(/\S+\s+in\s+(\S+)/gi,"$1"),dataChange=Air.NS(group,c).length!==b.cloneNodes.length,(needRepeat&&dataChange||needRepeat&&!b.repeaded)&&e(b,c)};beacon(c).on(j.DATA_CHANGE,d)}function e(a,b){beacon(a.cloneNodes).on(l,{$scope:b}),a.cloneNodes=[],f(a,b)}function f(a,b,c){var d=a.getAttribute(k);g(a).hasAttribute(k);c=a.placeholder;var e=document.createDocumentFragment(),f=d.replace(/\S+\s+in\s+(\S+)/gi,"$1"),h=d.match(/(\S+)\s+in\s+(\S+)/i)[1],m=Air.NS(f,b),n=[];a.cloneNodes=a.cloneNodes||[];for(var o=0;o<m.length;o++){var p=a.cloneNode(!0);a.cloneNodes.push(p),beacon(p).once(l,function(a,b){this.parentNode.removeChild(this)}),p.removeAttribute(k);var q=new i(b);beacon.on("clear::scopeEvnet",function(){beacon(q).off()}),q[h]=m[o],q.$index=o,q.$parentScope=b,q.$update=function(a){return function(){var c=Air.NS(f,b);return this[h]=c[a],c[a]}}(o),n.push({node:p.childNodes,$scope:q}),e.appendChild(p)}return c.parentNode.insertBefore(e,c),beacon(a).on(j.REPEAT_DONE,n),a.repeaded=!0,{scope:m,nodes:n}}var g=a("utility.node"),h=a("core.directive"),i=a("core.scope"),j=(a("core.scopeList"),a("core.event")),k=h.signup("repeat","ng-repeat"),l=beacon.createEvent("cloneNodeRemove"),m=function(a,c){var d=g(a).hasAttribute(k);a.placeholder=d&&b(a,c),f(a,c)};return m}),Air.Module("core.scopeTree",function(a){function b(a){beacon(a).on(g.REPEAT_DONE,function(a,b){for(var d=0;d<b.length;d++){var e=b[d];c(e.node,e.$scope),beacon(e.$scope).on(g.REPEAT_DATA_CHANGE,e.$scope)}})}function c(f,n){for(var o=a("core.scopeList"),p=f.length,q=0;p>q;q++){var r=f[q];if(r.nodeType==k.TEXT||r.nodeType==k.ATTR){var s=(r.nodeValue,r.nodeValue),t=function(a,b){return function(c,d){var f=a,g=b,h=g.match(/{{.*?}}/gi)||[];d=d||this;for(var i=h.length-1;i>=0;i--){var j=h[i],k=j.replace(/{{|}}/gi,""),l=Air.NS(k,d);l=e.isEmpty(l)?"":l,g=g.replace(j,l)}f.nodeValue!=g&&(f.nodeValue=g)}}(r,r.nodeValue);s.match(m)&&(n.$parentScope&&beacon(n.$parentScope).on(g.DATA_CHANGE,function(){n.$update(),beacon(n).on(g.DATA_CHANGE)}),beacon(n).on(g.DATA_CHANGE,t),beacon(n).on(g.REPEAT_DATA_CHANGE,t))}else if(r.nodeType==k.HTML){var u=d(r).hasAttribute(l.repeat);if(u){b(r);h(r,n)}else{var v=r.attributes.getNamedItem(l.controller);if(v){var w=r.getAttribute(l.controller),x=o.set(w,n);c(r.attributes,x),j(r,x),i(r,x),c(r.childNodes,x)}else c(r.attributes,n),j(r,n),i(r,n),c(r.childNodes,n)}}}}var d=(a("core.scope"),a("utility.node")),e=a("utility.util"),f=a("core.directive"),g=a("core.event"),h=a("directive.repeat"),i=a("direcitve.event"),j=a("direcitve.model"),k=d.type,l=f.key,m=/{{.*?}}/gi;return c}),Air.Module("core.url",function(a){var b=a("core.router"),c=a("core.event"),d={change:function(a,b){b=b||{};var e=d.getURLPath(a,b);if(e){var f=location.href,g={viewName:a};1==b.replace?history.replaceState(g,"viewName",e):history.pushState(g,"viewName",e),beacon.on(c.URL_CHANGE,{from:f,to:e})}},getURLPath:function(a,c){c=c||{};var d,e=c.params||{},f=c.query||"",g=b.getRule(a);if(g){var h=g.replace(/:(\w+)/gi,function(a,b){return e[b]||""});h=h.replace(/\/\/+/g,"/"),d=location.origin+h+f}return d}};return d}),Air.Module("core.viewManager",function(a){function b(a){var b=a.replace(/(href|src)=([\"])([^'"]+)\2/gi,function(a){var b=a.replace("{{resourceUrl}}",l.get("resourceUrl")||"");return b});return b}function c(a){var b=a.querySelectorAll("script");b=[].slice.call(b);for(var c=b.length-1;c>=0;c--){var d=b[c],e=document.createElement("script");d.src?e.src=d.src:e.text=d.text,a.appendChild(e),d.parentNode.removeChild(d)}}function d(a,d,f){var g=document.querySelector("viewport[main='true']"),h=document.createElement("view"),d=b(d);e(a,h,d,f),r.active&&r.active.removeAttribute("active"),h.setAttribute("active","true"),h.setAttribute("name",a),h.innerHTML=d,g.appendChild(h),r.count+=1,r.active=h,m.init(h,n),c(h)}function e(a,b,c,d){d=d||{},q[a]={template:c,view:b,url:o.getURLPath(a,d)}}function f(){for(var a=document.querySelectorAll("viewport[main='true'] view"),b=0;b<a.length;b++){var c=a[b],d=c.getAttribute("name")||"view"+b,f=c.innerHTML;e(d,c,f)}r.count=a.length,r.active=document.querySelector("viewport[main='true'] view[active='true']")}function g(a){r.active&&r.active.removeAttribute("active"),a.setAttribute("active","true"),r.active=a}function h(a,b){var c=o.getURLPath(a,b),e=q[a];return e&&e.url===c?(g(e.view),e):e&&e.url!==c?(b.noRender||(j(a),p.show(),d(a,e.template,b)),e):void 0}function i(){for(var a in q)j(a);r.active=null,r.count=0}function j(a){var b=q[a].view;k(b),b.parentNode.removeChild(b),delete q[a],r.count-=1,"true"===b.getAttribute("active")&&(r.active=null)}function k(a){for(var b=0;b<a.childNodes.length;b++)beacon(a.childNodes[b]).off(),k(a.childNodes[b])}var l=a("core.config"),m=a("core.scopeList"),n=a("core.scopeTree"),o=a("core.url"),p=a("utility.switchStyle"),q={},r={active:null,count:0};Air.domReady(function(){f()});var s={append:d,show:h,getCount:function(a){return r.count=a||r.count,r.count},getActive:function(){return r.active},remove:function(a){q[a];a?j(a):i()}};return s}),Air.Module("core.views",function(a){function b(a,b){var c=new d;beacon(c).once(d.EVENTS.REQUEST_COMPLETE,function(c,d){var e=d.data;l.show(),e&&k.append(a,e,b),beacon.on(n.EVENTS.SHOWED,{viewName:a}),b.popstate||g.change(a,b)});var f=e.getSign(a);f=f&&"_"+f,c.get(j.get("templatePath")+a+f+".html")}function c(){setTimeout(function(){window.scrollTo(0,0)},0)}var d=a("core.network.request"),e=a("core.router"),f=a("core.scopeList"),g=a("core.url"),h=a("utility.util"),i=(a("core.scopeTree"),a("core.event")),j=a("core.config"),k=a("core.viewManager"),l=a("utility.switchStyle"),m=a("utility.TDK"),n={EVENTS:{SHOWED:beacon.createEvent(""),SHOWEBEFOR:beacon.createEvent("")},router:e,init:function(a){a=a||window.location.pathname;var b=(h.enums(a.replace(/^\/|\/$/,"").split("/")),e.getQueryString()),c=document.querySelector("viewport[main='true']");c||(c=document.createElement("viewport"),c.setAttribute("main","true"),document.body.appendChild(c));var d=c.querySelector("view[active='true']");if(!d){n.getCount(0);var f=e.match(a);f?n["goto"](f.viewName,{params:f.params,query:b,replace:!0}):beacon.on(i.PAGE404)}},"goto":function(a,d){d=d||{},beacon.on(n.EVENTS.SHOWEBEFOR,{viewName:a});var e=k.show(a,d);if(e){var h=f.get(a);h&&m.set(h.$TDK),d.popstate||g.change(a,d),c(),beacon.on(n.EVENTS.SHOWED,{viewName:a})}else beacon.on("clear::scopeEvnet"),b(a,d)},remove:k.remove,getCount:k.getCount,getActive:k.getActive};return n}),Air.Module("core.service",function(a){function c(a){var b=a.protocol+"://"+a.host+a.path;return b}var d=a("core.network.request"),e=a("core.event"),f=(a("core.config"),{COMPLETE:beacon.createEvent("service response complete"),SUCCESS:beacon.createEvent("service response success"),ERROR:beacon.createEvent("service response error"),BEFORE_QUERY:beacon.createEvent("service before query")}),g=function(a){var g=b.config.get("service"),h=g[a];return serviceAPI={set:function(a){var b=function(){var b={COMPLETE:beacon.createEvent("service response complete"),SUCCESS:beacon.createEvent("service response success"),ERROR:beacon.createEvent("service response error")};beacon.utility.blend(a,h,{cover:!1});var g=new d,i={query:function(h,i){i=i||{};var j={preserve:!1,scope:null};beacon.utility.blend(i,j,{cover:!1});var k={};beacon(g).once(d.EVENTS.REQUEST_COMPLETE,function(c,d){var g=function(){beacon.on(b.SUCCESS,k),beacon.on(f.SUCCESS,k)},h=function(){beacon.on(b.ERROR,k),beacon.on(f.ERROR,k)},j=!1;if(!d.err)try{k.data=JSON.parse(d.data)}catch(c){j=!0,k.data=d.data,k.error="parseError"}if(j&&(d.err="parseError"),a.afterQuery&&a.afterQuery.length){var l=function(a,b){b||(a?g():h())},m=0,n=a.afterQuery.length,o=function(b,c){var e=a.afterQuery[m];return n>m&&e?void e(d,function(a,b){m++,o(a,b)}):void l(b,c)};o()}else g();beacon.on(b.COMPLETE,k),beacon.on(f.COMPLETE,k),i.scope&&beacon.on(e.DATA_CHANGE,i.scope)});var l=a.header||{};l["Content-Type"]="application/json;charset=utf-8";var m={method:a.method,url:c(a),data:h&&JSON.stringify(h)||null,header:l},n=function(){g.request(m)};if(a.beforeQuery&&a.beforeQuery.length){var o=0,p=a.beforeQuery.length,q=function(){var b=a.beforeQuery[o];return p>o&&b?void b(m,function(){o++,q()}):void n()};q()}else n();return k},on:beacon.on,off:beacon.off,once:beacon.once,EVENTS:b};return i};return{getInstance:b}}},serviceAPI};return g.EVENTS=f,g}),Air.Module("core.run",function(a){var b=a("core.event"),c=a("core.service"),d=(a("core.scopeList"),a("utility.switchStyle")),e=a("utility.TDK"),f=function(f,g){var h=a("core.scopeList"),i=h.get(f);beacon.on(c.EVENTS.COMPLETE,function(a,c){beacon(i).on(b.DATA_CHANGE,i)}),Air.run(g,!1,i),Air.run(function(){beacon(i).on(b.DATA_CHANGE,i),d.hide(),e.set(i.$TDK),beacon.on("hi",i)})};return f}),Air.run(function(a){var c=(a("core.scope"),a("utility.node"),a("core.scopeTree")),d=a("core.views");directive=a("core.directive");var e=(a("core.event"),"b");Air.domReady(function(){var d=a("core.scopeList");d.init(document,c),beacon(window).on("popstate",function(a){a.state&&a.state.viewName&&b.views["goto"](a.state.viewName,{popstate:!0})})}),void function(){var b={run:a("core.run"),views:d,config:a("core.config"),EVENTS:a("core.event"),Module:Air.Module,service:a("core.service"),loadJS:Air.loadJS};window[e]=b}()});